<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets Cyber Campus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications ici) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">×</span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i data-lucide="share-2"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i data-lucide="file-text"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i data-lucide="history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i data-lucide="x"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i data-lucide="printer"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i data-lucide="file-down"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0x41d4ec=_0x5b74;(function(_0x51824d,_0x1a7e2d){const _0x206c8d=_0x5b74,_0x44ee03=_0x51824d();while(!![]){try{const _0x5af515=-parseInt(_0x206c8d(0x120))/0x1+parseInt(_0x206c8d(0x134))/0x2*(parseInt(_0x206c8d(0x116))/0x3)+-parseInt(_0x206c8d(0x1cf))/0x4+parseInt(_0x206c8d(0x180))/0x5*(parseInt(_0x206c8d(0x1b6))/0x6)+parseInt(_0x206c8d(0x12f))/0x7*(-parseInt(_0x206c8d(0x168))/0x8)+-parseInt(_0x206c8d(0x1af))/0x9+-parseInt(_0x206c8d(0xf6))/0xa*(-parseInt(_0x206c8d(0x117))/0xb);if(_0x5af515===_0x1a7e2d)break;else _0x44ee03['push'](_0x44ee03['shift']());}catch(_0x10915a){_0x44ee03['push'](_0x44ee03['shift']());}}}(_0x35fc,0xd02ab));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';import{getDatabase,ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';const firebaseConfig={'apiKey':_0x41d4ec(0x111),'authDomain':_0x41d4ec(0x1c8),'databaseURL':_0x41d4ec(0x10d),'projectId':_0x41d4ec(0x165),'storageBucket':_0x41d4ec(0xf5),'messagingSenderId':_0x41d4ec(0x114),'appId':_0x41d4ec(0x15e),'measurementId':_0x41d4ec(0x137)},app=initializeApp(firebaseConfig),db=getDatabase(app),adminRef=ref(db,_0x41d4ec(0x160));let ticketToSell=null,localTickets={},currentReservedTicket=null,currentVendorId='',vendors={},availableUsernames=[];window[_0x41d4ec(0x140)]=window[_0x41d4ec(0x16b)]['jsPDF'];async function fetchVendors(){const _0x5a5019=_0x41d4ec;try{const _0x456a3d=ref(db,_0x5a5019(0x177)),_0x25aaa4=await get(_0x456a3d);_0x25aaa4[_0x5a5019(0xfa)]()?(vendors=_0x25aaa4[_0x5a5019(0x158)](),availableUsernames=Object['keys'](vendors)):console[_0x5a5019(0x172)](_0x5a5019(0x1b8));}catch(_0x4e570c){console[_0x5a5019(0x161)](_0x5a5019(0x127),_0x4e570c);}}const usernameInput=document[_0x41d4ec(0x17b)](_0x41d4ec(0x1bb)),passwordInput=document['getElementById']('password'),suggestionsList=document['getElementById'](_0x41d4ec(0x1b4));usernameInput[_0x41d4ec(0x186)](_0x41d4ec(0x124),()=>{const _0x191db2=_0x41d4ec,_0x58be82=usernameInput[_0x191db2(0x18f)][_0x191db2(0x1bc)](),_0x25fb19=availableUsernames[_0x191db2(0x16d)](_0x152fe4=>_0x152fe4[_0x191db2(0x1bc)]()[_0x191db2(0x10a)](_0x58be82));suggestionsList[_0x191db2(0x13a)]='';if(_0x58be82[_0x191db2(0x17d)]===0x0||_0x25fb19[_0x191db2(0x17d)]===0x0){suggestionsList[_0x191db2(0x10b)][_0x191db2(0x18d)]=_0x191db2(0x1a0);return;}_0x25fb19[_0x191db2(0x146)](_0x5cf41a=>{const _0x23506f=_0x191db2,_0x29af2b=document['createElement']('li');_0x29af2b['textContent']=_0x5cf41a,_0x29af2b[_0x23506f(0x186)](_0x23506f(0x1b5),()=>{const _0x2dac56=_0x23506f;usernameInput['value']=_0x5cf41a,suggestionsList[_0x2dac56(0x13a)]='',suggestionsList[_0x2dac56(0x10b)][_0x2dac56(0x18d)]=_0x2dac56(0x1a0);}),suggestionsList['appendChild'](_0x29af2b);}),suggestionsList[_0x191db2(0x10b)][_0x191db2(0x18d)]=_0x191db2(0x15d);}),document[_0x41d4ec(0x186)]('click',_0x154764=>{const _0x27c97f=_0x41d4ec;!usernameInput[_0x27c97f(0x167)](_0x154764[_0x27c97f(0x14c)])&&!suggestionsList[_0x27c97f(0x167)](_0x154764[_0x27c97f(0x14c)])&&(suggestionsList['style']['display']=_0x27c97f(0x1a0));});const rememberMeCheckbox=document[_0x41d4ec(0x17b)](_0x41d4ec(0x115)),storedUsername=localStorage[_0x41d4ec(0x1d3)](_0x41d4ec(0x1bb)),storedPassword=localStorage['getItem'](_0x41d4ec(0x1b0)),storedTimestamp=localStorage[_0x41d4ec(0x1d3)]('usernameTimestamp'),now=Date['now'](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput[_0x41d4ec(0x18f)]=storedUsername,passwordInput[_0x41d4ec(0x18f)]=storedPassword,rememberMeCheckbox[_0x41d4ec(0x132)]=!![]);const loginForm=document[_0x41d4ec(0x17b)](_0x41d4ec(0xff)),loginError=document[_0x41d4ec(0x17b)](_0x41d4ec(0x19c)),ratesSection=document[_0x41d4ec(0xf8)](_0x41d4ec(0x1ae)),historySection=document[_0x41d4ec(0x17b)](_0x41d4ec(0x16f)),loginSection=document[_0x41d4ec(0x17b)](_0x41d4ec(0x14e)),messagesSection=document[_0x41d4ec(0x17b)]('messagesSection');loginForm['addEventListener'](_0x41d4ec(0x100),async _0x44a972=>{const _0x4114e2=_0x41d4ec;_0x44a972[_0x4114e2(0x162)](),showLoader();const _0x4665cc=usernameInput[_0x4114e2(0x18f)],_0x468815=passwordInput[_0x4114e2(0x18f)];vendors[_0x4665cc]&&vendors[_0x4665cc][_0x4114e2(0x1b0)]===_0x468815?(loginError[_0x4114e2(0x10b)][_0x4114e2(0x18d)]=_0x4114e2(0x1a0),ratesSection[_0x4114e2(0x10b)][_0x4114e2(0x18d)]=_0x4114e2(0x15d),historySection[_0x4114e2(0x10b)][_0x4114e2(0x18d)]=_0x4114e2(0x1a0),loginSection[_0x4114e2(0x10b)]['display']=_0x4114e2(0x1a0),messagesSection[_0x4114e2(0x10b)][_0x4114e2(0x18d)]='block',currentVendorId=_0x4665cc,rememberMeCheckbox[_0x4114e2(0x132)]?(localStorage[_0x4114e2(0x191)](_0x4114e2(0x1bb),_0x4665cc),localStorage[_0x4114e2(0x191)](_0x4114e2(0x1b0),_0x468815),localStorage[_0x4114e2(0x191)](_0x4114e2(0x1a9),Date[_0x4114e2(0x149)]())):(localStorage[_0x4114e2(0x131)](_0x4114e2(0x1bb)),localStorage[_0x4114e2(0x131)](_0x4114e2(0x1b0)),localStorage[_0x4114e2(0x131)](_0x4114e2(0x1a9))),await syncTickets(),loadHistory(),listenForNewMessages(),lucide[_0x4114e2(0x17c)](),hideLoader()):(loginError[_0x4114e2(0x10b)][_0x4114e2(0x18d)]=_0x4114e2(0x15d),loginError['textContent']=_0x4114e2(0x1bf),hideLoader());});async function syncTickets(){const _0x1691d5=_0x41d4ec;try{const _0x8cfeb2=document[_0x1691d5(0xf8)](_0x1691d5(0x147)),_0x3f1b75=document[_0x1691d5(0xf8)](_0x1691d5(0x13f));_0x8cfeb2['style'][_0x1691d5(0x18d)]=_0x1691d5(0x15d),_0x3f1b75[_0x1691d5(0x10b)][_0x1691d5(0x18d)]=_0x1691d5(0x1a0);const _0x3528ad=ref(db,'TicketsTotal'),_0x1f21d8=await get(_0x3528ad);_0x1f21d8[_0x1691d5(0xfa)]()?(localTickets=_0x1f21d8[_0x1691d5(0x158)](),createTicketTable(),_0x8cfeb2[_0x1691d5(0x10b)][_0x1691d5(0x18d)]=_0x1691d5(0x1a0),_0x3f1b75['style'][_0x1691d5(0x18d)]=_0x1691d5(0x198)):_0x8cfeb2[_0x1691d5(0x1b3)]='Aucun\x20ticket\x20disponible.';}catch(_0x5eb701){console[_0x1691d5(0x161)]('Erreur\x20de\x20synchronisation:',_0x5eb701),loadingMessage[_0x1691d5(0x1b3)]=_0x1691d5(0x135);}}async function createTicketTable(){const _0x1a463d=_0x41d4ec,_0x3d89d9=document[_0x1a463d(0xf8)](_0x1a463d(0x13f));_0x3d89d9['innerHTML']=_0x1a463d(0x123);for(const [_0xde44c5,_0x164428]of Object[_0x1a463d(0x11e)](localTickets)){const _0x359584=_0x164428[_0x1a463d(0x144)]?_0x164428[_0x1a463d(0x144)][_0x1a463d(0x17d)]:0x0;if(_0x359584>0x0){const _0x5d4d8b=_0x164428[_0x1a463d(0x15b)][0x0],_0xdc2e44=_0x3d89d9[_0x1a463d(0x163)]();_0xdc2e44[_0x1a463d(0x13a)]=_0x1a463d(0xf3)+_0xde44c5+_0x1a463d(0x14b)+_0x5d4d8b+_0x1a463d(0x14b)+_0x359584+_0x1a463d(0x1d4)+_0xde44c5+_0x1a463d(0x103);}}document[_0x1a463d(0xf8)](_0x1a463d(0x147))['style'][_0x1a463d(0x18d)]='none',_0x3d89d9[_0x1a463d(0x10b)][_0x1a463d(0x18d)]=_0x1a463d(0x198);}function _0x5b74(_0x1be972,_0xf0716d){const _0x35fc32=_0x35fc();return _0x5b74=function(_0x5b7477,_0x200f39){_0x5b7477=_0x5b7477-0xf1;let _0xd137e3=_0x35fc32[_0x5b7477];return _0xd137e3;},_0x5b74(_0x1be972,_0xf0716d);}window[_0x41d4ec(0x139)]=async function(_0x1eafd3){const _0x19f468=_0x41d4ec;showLoader();try{const _0x499c95=ref(db,_0x19f468(0x130)+_0x1eafd3),_0x13c491=await get(_0x499c95);if(_0x13c491[_0x19f468(0xfa)]()){const _0x41bc2d=_0x13c491[_0x19f468(0x158)]();if(!_0x41bc2d[_0x19f468(0x144)]||_0x41bc2d['utilisateur'][_0x19f468(0x17d)]===0x0)throw new Error(_0x19f468(0x11f));ticketToSell={'category':_0x1eafd3,'user':_0x41bc2d[_0x19f468(0x144)][0x0],'password':_0x41bc2d[_0x19f468(0x13c)][0x0],'price':_0x41bc2d['prix'][0x0],'updatedData':{..._0x41bc2d,'utilisateur':_0x41bc2d['utilisateur'][_0x19f468(0x15c)](0x1),'motDePasse':_0x41bc2d[_0x19f468(0x13c)][_0x19f468(0x15c)](0x1),'prix':_0x41bc2d['prix'][_0x19f468(0x15c)](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x1f2748){console['error'](_0x19f468(0x181),_0x1f2748),showNotification(_0x19f468(0x154),_0x19f468(0x1cd)),hideLoader();}};function showConfirmation(_0x439b70){const _0x4e093b=_0x41d4ec,_0x27ac15=document['getElementById'](_0x4e093b(0x1ba)),_0x447c78=document[_0x4e093b(0x17b)]('notification-message'),_0x50e3f9=document[_0x4e093b(0x17b)](_0x4e093b(0x1c7)),_0x5b71af=document[_0x4e093b(0x17b)](_0x4e093b(0x1c1));document[_0x4e093b(0x17b)](_0x4e093b(0x15f))[_0x4e093b(0x1b3)]=_0x4e093b(0x1c0),_0x447c78[_0x4e093b(0x13a)]=_0x4e093b(0x105)+_0x439b70[_0x4e093b(0x125)]+_0x4e093b(0x166)+_0x439b70['price']+_0x4e093b(0x159),_0x5b71af[_0x4e093b(0x10b)][_0x4e093b(0x18d)]=_0x4e093b(0x19a),_0x50e3f9[_0x4e093b(0x10b)][_0x4e093b(0x18d)]=_0x4e093b(0x1a0),_0x27ac15[_0x4e093b(0x10b)]['display']=_0x4e093b(0x15d);}window[_0x41d4ec(0x199)]=async function(){const _0x19ed6a=_0x41d4ec;showLoader();if(!ticketToSell){showNotification(_0x19ed6a(0x154),_0x19ed6a(0x1a7)),hideLoader();return;}try{const _0x211219=ref(db,_0x19ed6a(0x130)+ticketToSell[_0x19ed6a(0x125)]);await set(_0x211219,ticketToSell[_0x19ed6a(0x156)]);const _0x22f9b6=ref(db,_0x19ed6a(0xfe));await push(_0x22f9b6,{'category':ticketToSell[_0x19ed6a(0x125)],'user':ticketToSell['user'],'password':ticketToSell[_0x19ed6a(0x1b0)],'price':ticketToSell[_0x19ed6a(0x12d)],'soldAt':Date[_0x19ed6a(0x149)](),'vendorId':currentVendorId});const _0x3ef2a8=ref(db,'VendorsHistory/'+currentVendorId);await push(_0x3ef2a8,{'category':ticketToSell[_0x19ed6a(0x125)],'user':ticketToSell[_0x19ed6a(0xfd)],'password':ticketToSell[_0x19ed6a(0x1b0)],'price':ticketToSell[_0x19ed6a(0x12d)],'soldAt':Date['now']()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x3fd16f){console['error'](_0x19ed6a(0x12c),_0x3fd16f),showNotification(_0x19ed6a(0x154),_0x19ed6a(0xf4)),hideLoader();}ticketToSell=null;};function showTicketDetails(_0x3412e1){const _0x5679a5=_0x41d4ec,_0x17f9fb=document['getElementById'](_0x5679a5(0x1ba)),_0x2323e8=document[_0x5679a5(0x17b)]('notification-message'),_0x3e7ad1=document[_0x5679a5(0x17b)](_0x5679a5(0x1c7)),_0x57ee78=document[_0x5679a5(0x17b)](_0x5679a5(0x1c1));document[_0x5679a5(0x17b)](_0x5679a5(0x15f))[_0x5679a5(0x1b3)]=_0x5679a5(0x10c),_0x2323e8[_0x5679a5(0x13a)]=_0x5679a5(0x18a)+_0x3412e1[_0x5679a5(0x125)]+_0x5679a5(0xf1)+_0x3412e1['user']+_0x5679a5(0xf9)+_0x3412e1[_0x5679a5(0x1b0)]+_0x5679a5(0x166)+_0x3412e1[_0x5679a5(0x12d)]+_0x5679a5(0x159),_0x57ee78['style'][_0x5679a5(0x18d)]=_0x5679a5(0x1a0),_0x3e7ad1[_0x5679a5(0x10b)]['display']=_0x5679a5(0x19a),_0x17f9fb[_0x5679a5(0x10b)]['display']=_0x5679a5(0x15d),lucide[_0x5679a5(0x17c)]();}function showSaleConfirmation(_0x229b7c){const _0xa057bf=_0x41d4ec,_0x43ef7f=document['getElementById'](_0xa057bf(0x1ba)),_0x55bfcc=document[_0xa057bf(0x17b)](_0xa057bf(0x102)),_0x1110ea=document[_0xa057bf(0x17b)](_0xa057bf(0x193));_0x55bfcc[_0xa057bf(0x13a)]=_0xa057bf(0x18a)+_0x229b7c[_0xa057bf(0x125)]+_0xa057bf(0xf1)+_0x229b7c['user']+_0xa057bf(0xf9)+_0x229b7c[_0xa057bf(0x1b0)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x229b7c[_0xa057bf(0x12d)]+'\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x1110ea['innerHTML']=_0xa057bf(0x17f),_0x43ef7f['style'][_0xa057bf(0x18d)]=_0xa057bf(0x15d),lucide[_0xa057bf(0x17c)]();}window['confirmSale']=async function(){const _0x4cf347=_0x41d4ec;showLoader();if(!currentReservedTicket){showNotification(_0x4cf347(0x154),'Aucun\x20ticket\x20en\x20cours\x20de\x20vente'),hideLoader();return;}try{const _0x2956fa=ref(db,_0x4cf347(0xfe));await push(_0x2956fa,{...currentReservedTicket,'soldAt':Date[_0x4cf347(0x149)](),'vendorId':currentVendorId});const _0x44c1d6=ref(db,_0x4cf347(0x10f)+currentVendorId);await push(_0x44c1d6,{...currentReservedTicket,'soldAt':Date['now']()}),showNotification(_0x4cf347(0x1b7),_0x4cf347(0x107)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0x195fc){console[_0x4cf347(0x161)](_0x4cf347(0x151),_0x195fc),showNotification(_0x4cf347(0x154),_0x4cf347(0x108)),hideLoader();}},window[_0x41d4ec(0x1c5)]=function(){currentReservedTicket=null,hideNotification();};function _0x35fc(){const _0x340991=['\x20FCFA','none','getDay','exportToExcelHistory','Historique\x20des\x20ventes','scrollHeight','href','Détails\x20du\x20Ticket','Aucun\x20ticket\x20à\x20vendre','left','usernameTimestamp','/messages','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','exportToPDF','height','.rates-section','12906135ePQqri','password','center','width','textContent','autocompleteSuggestions','click','36690pHhsoE','Succès','Aucun\x20vendeur\x20trouvé.','messagesContainer','notification','username','toLowerCase','Ticket\x20introuvable\x20dans\x20l\x27historique','pageLoaderWrapper','Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.','Confirmation\x20de\x20vente','confirmation-buttons','timestamp','totalRevenue','reduce','cancelSale','Partage\x20réussi','ticket-actions','cyber-campus-2706f.firebaseapp.com','Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:','Erreur\x20lors\x20de\x20l\x27initialisation\x20:','hideNotification','setDate','Impossible\x20de\x20récupérer\x20le\x20ticket','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','276284YDqyVr','settings','save','classList','getItem','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20','Page\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','Impossible\x20de\x20finaliser\x20la\x20vente','cyber-campus-2706f.appspot.com','30lhPOcN','print','querySelector','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','exists','appendChild','getDate','user','TicketsVendus','loginForm','submit','catch','notification-message','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','getHeight','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','historyTableBody','Ticket\x20vendu\x20avec\x20succès!','Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente','Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.','startsWith','style','Ticket\x20vendu\x20avec\x20succès','https://cyber-campus-2706f-default-rtdb.firebaseio.com','Pas\x20d\x27abonnement\x20actif','VendorsHistory/','Abonnement\x20expiré','AIzaSyB6AUBnK_7Vy2ABWI2JMo3ebG_Sljr8XlY','endDate','toFixed','719410601264','rememberMe','174fENRvR','9256973ERhSuV','div','periodFilter','pageSize','redirectToSubscription','grid','min','entries','Plus\x20de\x20tickets\x20disponibles','1510711AXqLsS','text','expired','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','input','category','addImage','Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:','exportToPDFHistory','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','Impossible\x20de\x20charger\x20l\x27historique','Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket','Erreur\x20lors\x20de\x20la\x20vente:','price','topCategory','14XsCYqR','TicketsTotal/','removeItem','checked','innerText','7864VEpSaa','Erreur\x20de\x20synchronisation\x20des\x20tickets.','PNG','G-CEEFJP5LYZ','writeText','initTicketSale','innerHTML','update','motDePasse','utils','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:','.rates-section\x20table','jsPDF','setFontSize','toggleHistory','then','utilisateur','createElement','forEach','.loading-message','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','now','closeHistory','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','target','hideSubscriptionRequiredModal','loginSection','historique_ventes.pdf','Vérification\x20de\x20l\x27abonnement...','Erreur\x20de\x20confirmation:','getNumberOfPages','add','Erreur','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27','updatedData','showTicketDetailsFromHistory','val','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','filterHistory','prix','slice','block','1:719410601264:web:44fd2e3757721866303cf5','notification-title','admin/subscription','error','preventDefault','insertRow','setHours','cyber-campus-2706f','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','contains','314648nZBQYF','ceil','content','jspdf','map','filter','toLocaleString','historySection','internal','scrollTop','log','shareTicket','sort','max','margin','Vendors','write','share','index.html','getElementById','createIcons','length','table_to_book','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','975jiIMGe','Erreur:','autoTable','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fa-solid\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','avgDaily','application/octet-stream','addEventListener','Vendors/','bold','right','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','Erreur\x20lors\x20de\x20la\x20copie:','all','display','active','value','xlsx','setItem','printHistory','notification-buttons','ticket.pdf','location','join','soldAt','table','proceedWithSale','flex','copyTicket','loginError','startDate','getTime'];_0x35fc=function(){return _0x340991;};return _0x35fc();}function showNotification(_0x522790,_0x34dcfd){const _0x4b3023=_0x41d4ec,_0x2c54d6=document[_0x4b3023(0x17b)](_0x4b3023(0x1ba)),_0x20cefc=document[_0x4b3023(0x17b)](_0x4b3023(0x15f)),_0x16bb85=document[_0x4b3023(0x17b)](_0x4b3023(0x102)),_0x291dd6=document[_0x4b3023(0x17b)](_0x4b3023(0x193)),_0xa18e37=document['getElementById'](_0x4b3023(0x1c7));_0x20cefc[_0x4b3023(0x1b3)]=_0x522790,_0x16bb85['innerHTML']=_0x34dcfd,_0x522790==='Succès'||_0x522790===_0x4b3023(0x154)?(_0x291dd6[_0x4b3023(0x10b)][_0x4b3023(0x18d)]=_0x4b3023(0x1a0),_0xa18e37['style']['display']=_0x4b3023(0x1a0)):(_0x291dd6[_0x4b3023(0x10b)][_0x4b3023(0x18d)]='flex',_0xa18e37['style'][_0x4b3023(0x18d)]=_0x4b3023(0x1a0)),_0x2c54d6['style']['display']='block';}window[_0x41d4ec(0x1cb)]=function(){const _0x18d369=_0x41d4ec;document[_0x18d369(0x17b)]('notification')[_0x18d369(0x10b)][_0x18d369(0x18d)]='none';};async function loadHistory(){const _0x1904aa=_0x41d4ec;showLoader();try{const _0x387fba=ref(db,_0x1904aa(0x10f)+currentVendorId),_0x28c2c3=await get(_0x387fba);let _0xabf11=[];_0x28c2c3[_0x1904aa(0xfa)]()&&(_0xabf11=Object[_0x1904aa(0x11e)](_0x28c2c3['val']())[_0x1904aa(0x16c)](([_0x3c3d79,_0x2ac323])=>({'id':_0x3c3d79,..._0x2ac323}))),filterHistory(_0xabf11),hideLoader();}catch(_0x39726d){console[_0x1904aa(0x161)](_0x1904aa(0x1c9),_0x39726d),showNotification(_0x1904aa(0x154),_0x1904aa(0x12a)),hideLoader();}}function filterHistory(_0x1bed12){const _0x4fce35=_0x41d4ec,_0x5a90f2=document[_0x4fce35(0x17b)](_0x4fce35(0x119))[_0x4fce35(0x18f)],_0x4dce6d=new Date(),_0x244498={'today':new Date(_0x4dce6d[_0x4fce35(0x164)](0x0,0x0,0x0,0x0)),'week':new Date(_0x4dce6d[_0x4fce35(0x1cc)](_0x4dce6d[_0x4fce35(0xfc)]()-_0x4dce6d[_0x4fce35(0x1a1)]())),'month':new Date(_0x4dce6d[_0x4fce35(0x1cc)](0x1)),'all':new Date(0x0)};let _0x31d5d7=_0x1bed12;_0x5a90f2!==_0x4fce35(0x18c)&&(_0x31d5d7=_0x1bed12[_0x4fce35(0x16d)](_0x285b7e=>new Date(_0x285b7e[_0x4fce35(0x197)])>=_0x244498[_0x5a90f2])),updateStats(_0x31d5d7),updateHistoryTable(_0x31d5d7);}window['filterHistoryByDateRange']=function(){const _0x600971=_0x41d4ec,_0x27207b=new Date(document[_0x600971(0x17b)](_0x600971(0x19d))[_0x600971(0x18f)]),_0x597b2b=new Date(document[_0x600971(0x17b)](_0x600971(0x112))['value']);_0x597b2b[_0x600971(0x164)](0x17,0x3b,0x3b);if(isNaN(_0x27207b[_0x600971(0x19e)]())||isNaN(_0x597b2b['getTime']())){showNotification(_0x600971(0x154),_0x600971(0x109));return;}const _0x72e86e=ref(db,_0x600971(0x10f)+currentVendorId);get(_0x72e86e)[_0x600971(0x143)](_0x3682a8=>{const _0x31928b=_0x600971;let _0x231c97=[];_0x3682a8[_0x31928b(0xfa)]()&&(_0x231c97=Object[_0x31928b(0x11e)](_0x3682a8[_0x31928b(0x158)]())['map'](([_0x162683,_0x5f4400])=>({'id':_0x162683,..._0x5f4400})));const _0x2f0a38=_0x231c97[_0x31928b(0x16d)](_0x5a2fa0=>{const _0x426e0f=new Date(_0x5a2fa0['soldAt']);return _0x426e0f>=_0x27207b&&_0x426e0f<=_0x597b2b;});updateStats(_0x2f0a38),updateHistoryTable(_0x2f0a38);});};function updateStats(_0x52b2d9){const _0x2d36ff=_0x41d4ec,_0x429778=_0x52b2d9[_0x2d36ff(0x17d)],_0x4a1a25=_0x52b2d9[_0x2d36ff(0x1c4)]((_0xb39397,_0x3bfe84)=>_0xb39397+parseFloat(_0x3bfe84[_0x2d36ff(0x12d)]),0x0),_0x19647d=_0x52b2d9[_0x2d36ff(0x1c4)]((_0x2823a3,_0x28b393)=>{const _0x3727ee=_0x2d36ff;return _0x2823a3[_0x28b393['category']]=(_0x2823a3[_0x28b393[_0x3727ee(0x125)]]||0x0)+0x1,_0x2823a3;},{}),_0xed1779=Object[_0x2d36ff(0x11e)](_0x19647d)[_0x2d36ff(0x174)]((_0x4147a1,_0x3f05f3)=>_0x3f05f3[0x1]-_0x4147a1[0x1])[0x0]?.[0x0]||'-',_0x5211e6=_0x52b2d9['length']>0x0?Math[_0x2d36ff(0x175)](0x1,Math[_0x2d36ff(0x169)]((Date[_0x2d36ff(0x149)]()-Math[_0x2d36ff(0x11d)](..._0x52b2d9[_0x2d36ff(0x16c)](_0x407430=>_0x407430['soldAt'])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x2786c4=(_0x429778/_0x5211e6)[_0x2d36ff(0x113)](0x1);document[_0x2d36ff(0x17b)]('totalTickets')[_0x2d36ff(0x1b3)]=_0x429778,document[_0x2d36ff(0x17b)](_0x2d36ff(0x1c3))[_0x2d36ff(0x1b3)]=_0x4a1a25[_0x2d36ff(0x16e)]()+_0x2d36ff(0x19f),document[_0x2d36ff(0x17b)](_0x2d36ff(0x12e))[_0x2d36ff(0x1b3)]=_0xed1779,document[_0x2d36ff(0x17b)](_0x2d36ff(0x184))[_0x2d36ff(0x1b3)]=_0x2786c4;}function updateHistoryTable(_0x404b3e){const _0x2f64e9=_0x41d4ec,_0x28e5aa=document['getElementById'](_0x2f64e9(0x106));_0x28e5aa['innerHTML']=_0x404b3e[_0x2f64e9(0x174)]((_0x385df9,_0x41131c)=>_0x41131c['soldAt']-_0x385df9[_0x2f64e9(0x197)])[_0x2f64e9(0x16c)](_0x1fe1a7=>_0x2f64e9(0x155)+_0x1fe1a7['id']+'\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+new Date(_0x1fe1a7['soldAt'])[_0x2f64e9(0x16e)]()+_0x2f64e9(0x14b)+_0x1fe1a7[_0x2f64e9(0x125)]+_0x2f64e9(0x14b)+_0x1fe1a7['user']+_0x2f64e9(0x14b)+_0x1fe1a7[_0x2f64e9(0x12d)]+_0x2f64e9(0x183))[_0x2f64e9(0x196)]('');}window[_0x41d4ec(0x157)]=async function(_0x2ad1ce){const _0x59f0cb=_0x41d4ec;showLoader();try{const _0xe62c2f=ref(db,'VendorsHistory/'+currentVendorId+'/'+_0x2ad1ce),_0x560677=await get(_0xe62c2f);if(_0x560677[_0x59f0cb(0xfa)]()){const _0x4427b6=_0x560677[_0x59f0cb(0x158)]();window['closeHistory'](),showTicketDetails(_0x4427b6),hideLoader();}else showNotification(_0x59f0cb(0x154),_0x59f0cb(0x1bd)),hideLoader();}catch(_0x5bb86b){console[_0x59f0cb(0x161)]('Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:',_0x5bb86b),showNotification(_0x59f0cb(0x154),_0x59f0cb(0x12b)),hideLoader();}},window[_0x41d4ec(0x142)]=function(){const _0x65651d=_0x41d4ec,_0x10ff44=document['getElementById'](_0x65651d(0x16f)),_0x35b721=_0x10ff44['style']['display']===_0x65651d(0x15d);_0x10ff44[_0x65651d(0x10b)][_0x65651d(0x18d)]=_0x35b721?_0x65651d(0x1a0):_0x65651d(0x15d),!_0x35b721&&loadHistory();},window[_0x41d4ec(0x14a)]=function(){const _0x4c1907=_0x41d4ec;document[_0x4c1907(0x17b)](_0x4c1907(0x16f))['style']['display']=_0x4c1907(0x1a0);},window[_0x41d4ec(0x15a)]=function(){loadHistory();};function listenForNewMessages(){const _0x492d66=_0x41d4ec,_0x4fd3e8=ref(db,_0x492d66(0x187)+currentVendorId+_0x492d66(0x1aa));onChildAdded(_0x4fd3e8,_0xc119af=>{const _0x3dcde1=_0x492d66,_0x5c0e67=_0xc119af[_0x3dcde1(0x158)]();displayNewMessage(_0x5c0e67);});}function displayNewMessage(_0x9065be){const _0x47c3fb=_0x41d4ec,_0x284924=document[_0x47c3fb(0x17b)](_0x47c3fb(0x1b9)),_0x486dd9=document[_0x47c3fb(0x145)](_0x47c3fb(0x118));_0x486dd9[_0x47c3fb(0x1d2)][_0x47c3fb(0x153)]('message'),_0x486dd9[_0x47c3fb(0x13a)]=_0x47c3fb(0x129)+_0x9065be[_0x47c3fb(0x16a)]+_0x47c3fb(0x1ab)+new Date(_0x9065be[_0x47c3fb(0x1c2)])[_0x47c3fb(0x16e)]()+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x284924[_0x47c3fb(0xfb)](_0x486dd9),_0x284924[_0x47c3fb(0x171)]=_0x284924[_0x47c3fb(0x1a4)];}window[_0x41d4ec(0x173)]=function(){const _0x1ea0fd=_0x41d4ec,_0x54ace5=document[_0x1ea0fd(0x17b)](_0x1ea0fd(0x102))[_0x1ea0fd(0x133)];navigator['share']?navigator[_0x1ea0fd(0x179)]({'title':_0x1ea0fd(0x1a6),'text':_0x54ace5})[_0x1ea0fd(0x143)](()=>console[_0x1ea0fd(0x172)](_0x1ea0fd(0x1c6)))[_0x1ea0fd(0x101)](_0x4d6012=>console[_0x1ea0fd(0x161)]('Erreur\x20lors\x20du\x20partage:',_0x4d6012)):alert('Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.');},window[_0x41d4ec(0x19b)]=function(){const _0x2c967e=_0x41d4ec,_0xa44a30=document[_0x2c967e(0x17b)](_0x2c967e(0x102))[_0x2c967e(0x133)];navigator['clipboard'][_0x2c967e(0x138)](_0xa44a30)[_0x2c967e(0x143)](()=>{const _0x109704=_0x2c967e;showNotification(_0x109704(0x1b7),_0x109704(0x1ce));})[_0x2c967e(0x101)](_0x23af4e=>{const _0x3ec53b=_0x2c967e;console[_0x3ec53b(0x161)](_0x3ec53b(0x18b),_0x23af4e),showNotification(_0x3ec53b(0x154),'Impossible\x20de\x20copier\x20le\x20ticket');});},window[_0x41d4ec(0x1ac)]=async function(){const _0x156d4d=_0x41d4ec;showLoader();const _0x45588c=document[_0x156d4d(0x17b)]('notification-message'),_0x3eb6a9=new jsPDF(),_0x22cde4=await html2canvas(_0x45588c),_0x55a033=_0x22cde4['toDataURL']('image/png');_0x3eb6a9[_0x156d4d(0x126)](_0x55a033,_0x156d4d(0x136),0xa,0xa,0xbe,0x0),_0x3eb6a9[_0x156d4d(0x1d1)](_0x156d4d(0x194)),hideLoader();},window[_0x41d4ec(0x192)]=function(){const _0x239498=_0x41d4ec;window[_0x239498(0xf7)]();},window[_0x41d4ec(0x128)]=function(){const _0x457a4b=_0x41d4ec,{jsPDF:_0x26fb0e}=window[_0x457a4b(0x16b)],_0x4ac301=new _0x26fb0e(),_0x52970d=document[_0x457a4b(0x17b)](_0x457a4b(0x106)),_0xc875b={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':_0x457a4b(0x188),'halign':_0x457a4b(0x1b1)},_0x5679ba={'halign':_0x457a4b(0x1a8)},_0x36c591={'theme':_0x457a4b(0x11c),'headStyles':_0xc875b,'bodyStyles':_0x5679ba,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0x7e0603){const _0x46be74=_0x457a4b;_0x4ac301[_0x46be74(0x121)](_0x46be74(0x1a3),0xe,0xf);const _0x75694e=_0x46be74(0xf2)+_0x4ac301['internal'][_0x46be74(0x152)]();_0x4ac301[_0x46be74(0x141)](0xa);const _0x288239=_0x4ac301[_0x46be74(0x170)][_0x46be74(0x11a)],_0x156219=_0x288239[_0x46be74(0x1ad)]?_0x288239[_0x46be74(0x1ad)]:_0x288239[_0x46be74(0x104)]();_0x4ac301[_0x46be74(0x121)](_0x75694e,_0x7e0603[_0x46be74(0x1d0)][_0x46be74(0x176)][_0x46be74(0x1a8)],_0x156219-0xa),_0x4ac301[_0x46be74(0x121)](new Date()[_0x46be74(0x16e)](),_0x288239[_0x46be74(0x1b2)]-_0x7e0603[_0x46be74(0x1d0)][_0x46be74(0x176)][_0x46be74(0x189)]-0x28,_0x156219-0xa);}};_0x4ac301[_0x457a4b(0x182)]({'html':'#historyTableBody',..._0x36c591}),_0x4ac301[_0x457a4b(0x1d1)](_0x457a4b(0x14f));},window[_0x41d4ec(0x1a2)]=function(){const _0x4cade6=_0x41d4ec,_0x564ea7=XLSX[_0x4cade6(0x13d)][_0x4cade6(0x17e)](document[_0x4cade6(0x17b)]('historyTableBody'),{'sheet':'Ventes'}),_0x2c9798=XLSX[_0x4cade6(0x178)](_0x564ea7,{'bookType':_0x4cade6(0x190),'type':'binary'});function _0x1da46c(_0x541525){const _0x51f965=_0x4cade6,_0x33e7bd=new ArrayBuffer(_0x541525['length']),_0x551bbf=new Uint8Array(_0x33e7bd);for(let _0x1e953c=0x0;_0x1e953c<_0x541525[_0x51f965(0x17d)];_0x1e953c++)_0x551bbf[_0x1e953c]=_0x541525['charCodeAt'](_0x1e953c)&0xff;return _0x33e7bd;}saveAs(new Blob([_0x1da46c(_0x2c9798)],{'type':_0x4cade6(0x185)}),'historique_ventes.xlsx');};function showLoader(){const _0x120237=_0x41d4ec;document['getElementById']('loaderWrapper')[_0x120237(0x10b)]['display']=_0x120237(0x15d);}function hideLoader(){const _0x199863=_0x41d4ec;document[_0x199863(0x17b)]('loaderWrapper')[_0x199863(0x10b)][_0x199863(0x18d)]=_0x199863(0x1a0);}function showPageLoader(){const _0x4b94a9=_0x41d4ec;document[_0x4b94a9(0x17b)](_0x4b94a9(0x1be))[_0x4b94a9(0x10b)][_0x4b94a9(0x18d)]=_0x4b94a9(0x19a);}function hidePageLoader(){const _0x44f661=_0x41d4ec;document['getElementById']('pageLoaderWrapper')[_0x44f661(0x10b)][_0x44f661(0x18d)]=_0x44f661(0x1a0);}function showSubscriptionRequiredModal(){const _0xd2069=_0x41d4ec;subscriptionRequiredModal['style'][_0xd2069(0x18d)]=_0xd2069(0x19a);}function hideSubscriptionRequiredModal(){subscriptionRequiredModal['style']['display']='none';}function redirectToSubscription(){const _0x424a68=_0x41d4ec;window[_0x424a68(0x195)][_0x424a68(0x1a5)]=_0x424a68(0x17a);}async function checkSubscriptionStatus(){const _0x1f5762=_0x41d4ec,_0xfbfaa2=document[_0x1f5762(0x17b)]('pageLoaderMessage');_0xfbfaa2[_0x1f5762(0x1b3)]=_0x1f5762(0x150);try{const _0x155c76=await get(adminRef),_0x3d0f7d=_0x155c76[_0x1f5762(0x158)](),_0x3c3d0b=new Date();if(_0x3d0f7d&&_0x3d0f7d['status']===_0x1f5762(0x18e)){const _0x3d2076=new Date(_0x3d0f7d[_0x1f5762(0x112)]);_0x3d2076<_0x3c3d0b?(_0xfbfaa2['textContent']=_0x1f5762(0x110),showSubscriptionRequiredModal(),await adminRef[_0x1f5762(0x13b)]({'status':_0x1f5762(0x122)})):_0xfbfaa2[_0x1f5762(0x1b3)]='Abonnement\x20actif';}else _0xfbfaa2[_0x1f5762(0x1b3)]=_0x1f5762(0x10e),showSubscriptionRequiredModal();}catch(_0x2c2e6c){console[_0x1f5762(0x161)](_0x1f5762(0x13e),_0x2c2e6c),_0xfbfaa2[_0x1f5762(0x1b3)]='Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement',showNotification(_0x1f5762(0x154),'Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.');}}document['addEventListener']('DOMContentLoaded',()=>{const _0x5927b3=_0x41d4ec;checkSubscriptionStatus()[_0x5927b3(0x143)](()=>{fetchVendors(),lucide['createIcons'](),hidePageLoader();})[_0x5927b3(0x101)](_0x379d83=>{const _0x3b394d=_0x5927b3;console[_0x3b394d(0x161)](_0x3b394d(0x1ca),_0x379d83),showNotification(_0x3b394d(0x154),_0x3b394d(0x148)),hidePageLoader();});}),window[_0x41d4ec(0x11b)]=redirectToSubscription,window[_0x41d4ec(0x14d)]=redirectToSubscription;
    </script>
</body>
</html>
