<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets Cyber Campus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ... (Styles CSS - Pas de modifications ici) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #970158, #00026e, #000000);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">×</span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i data-lucide="share-2"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i data-lucide="file-text"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i data-lucide="history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i data-lucide="x"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0x2dd913=_0x5631;function _0x2839(){const _0x197665=['join','querySelector','update','Erreur\x20lors\x20du\x20traitement\x20des\x20tickets\x20connectés\x20:','Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:','129qDtrAr','getDate','ceil','style','Aucun\x20vendeur\x20trouvé.','https://cyberdemo-a38fc-default-rtdb.firebaseio.com','flex','loginSection','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','157171dVntBR','\x20vendu\x20automatiquement.','showTicketDetailsFromHistory','setItem','usernameTimestamp','loginError','click','.rates-section\x20table','input','appendChild','Erreur\x20de\x20synchronisation:','location','VendorsHistory','add','cyberdemo-a38fc','TicketsTotal/','historyTableBody','5CUrElW','hideNotification','addEventListener','admin/subscription','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fa-solid\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','updatedData','value','Impossible\x20de\x20récupérer\x20le\x20ticket','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','prix','2164524EodZCw','2483790giAlCw','proceedWithSale','560596573477','endDate','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement','669536eGzlfv','Impossible\x20de\x20copier\x20le\x20ticket','Erreur\x20lors\x20de\x20la\x20vente\x20automatique\x20du\x20ticket\x20:','expired','jsPDF','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27','username','Traitement\x20des\x20tickets\x20uniques...','/messages','map','div','messagesSection','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','confirmation-buttons','writeText','contains','Vendeur\x20automatique','Erreur\x20lors\x20du\x20traitement\x20des\x20tickets\x20:','loginForm','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:','.rates-section','none','toDataURL','Plus\x20de\x20tickets\x20disponibles','price','historySection','cancelSale','Erreur\x20de\x20confirmation:','pageLoaderMessage','Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:','textContent','TicketsTotal','sort','toggleHistory','Confirmation\x20de\x20vente','Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.','catch','Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27','loaderWrapper','forEach','innerHTML','Ticket\x20vendu\x20avec\x20succès!','preventDefault','pageLoaderWrapper','Vendors/','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','3886713gZVaZi','Abonnement\x20expiré','exportToPDF','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.','scrollTop','insertRow','table','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20','checked','toLowerCase','Erreur:','block','notification-buttons','then','clipboard','cyberdemo-a38fc.firebasestorage.app','cyberdemo-a38fc.firebaseapp.com','Vérification\x20du\x20ticket\x20pour\x20','user','getElementById','createIcons','\x20FCFA','ticket-actions','G-XH1RH6DYK5','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','filterHistory','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','Partage\x20réussi','innerText','content','getItem','12556OcwscN','now','length','22ryPXVM','Erreur\x20lors\x20de\x20la\x20vente:','val','filter','Vérification\x20de\x20l\x27abonnement...','VendorsHistory/','setHours','Ticket\x20vendu\x20avec\x20succès','message','log','Erreur\x20de\x20synchronisation\x20des\x20tickets.','18xEGxgO','TicketConnecté/','AIzaSyCqYu8n0ct6KcMhiEvTKO74mh824PrNXfk','77178ABMlkg','DOMContentLoaded','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','setDate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','ticket.pdf','slice','reduce','Traitement\x20du\x20ticket\x20','TicketConnecté','createElement','TicketsVendus','1:560596573477:web:f576224af5650fc081cecc','submit','image/png','Une\x20erreur\x20est\x20survenue\x20lors\x20du\x20traitement\x20des\x20tickets.','href','Pas\x20d\x27abonnement\x20actif','display','notification','Détails\x20du\x20Ticket','Impossible\x20de\x20charger\x20l\x27historique','hideSubscriptionRequiredModal','removeItem','Ticket\x20introuvable\x20dans\x20l\x27historique','target','exists','periodFilter','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','password','.loading-message','notification-title','startsWith','Erreur\x20lors\x20du\x20traitement\x20du\x20ticket\x20','TicketsTransit','PNG','notification-message','save','Aucun\x20ticket\x20à\x20vendre','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','Nettoyage\x20des\x20tickets\x20traités...','\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','closeHistory','entries','toLocaleString','Erreur','shareTicket','keys','utilisateur','min','toFixed','Erreur\x20lors\x20du\x20partage:','scrollHeight','TicketsTransit/','error','Erreur\x20lors\x20de\x20la\x20vente\x20automatique\x20du\x20ticket.','Erreur\x20lors\x20de\x20la\x20copie:','Succès','soldAt','autocompleteSuggestions','motDePasse','category','max'];_0x2839=function(){return _0x197665;};return _0x2839();}(function(_0x250eb3,_0x4727ee){const _0x231ea6=_0x5631,_0x4e74c6=_0x250eb3();while(!![]){try{const _0x642773=-parseInt(_0x231ea6(0x1bf))/0x1*(-parseInt(_0x231ea6(0xf3))/0x2)+-parseInt(_0x231ea6(0x139))/0x3*(-parseInt(_0x231ea6(0x1b1))/0x4)+parseInt(_0x231ea6(0x153))/0x5*(-parseInt(_0x231ea6(0x15d))/0x6)+-parseInt(_0x231ea6(0x142))/0x7+parseInt(_0x231ea6(0x163))/0x8+parseInt(_0x231ea6(0x192))/0x9+-parseInt(_0x231ea6(0x15e))/0xa*(parseInt(_0x231ea6(0x1b4))/0xb);if(_0x642773===_0x4727ee)break;else _0x4e74c6['push'](_0x4e74c6['shift']());}catch(_0x722f3c){_0x4e74c6['push'](_0x4e74c6['shift']());}}}(_0x2839,0x7190b));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';import{getDatabase,ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';const firebaseConfig={'apiKey':_0x2dd913(0x1c1),'authDomain':_0x2dd913(0x1a2),'databaseURL':_0x2dd913(0x13e),'projectId':_0x2dd913(0x150),'storageBucket':_0x2dd913(0x1a1),'messagingSenderId':_0x2dd913(0x160),'appId':_0x2dd913(0xff),'measurementId':_0x2dd913(0x1a9)},app=initializeApp(firebaseConfig),db=getDatabase(app),adminRef=ref(db,_0x2dd913(0x156));let ticketToSell=null,localTickets={},currentReservedTicket=null,currentVendorId='',vendors={},availableUsernames=[];window[_0x2dd913(0x167)]=window['jspdf'][_0x2dd913(0x167)];async function fetchVendors(){const _0x11f59f=_0x2dd913;try{const _0xc8e077=ref(db,'Vendors'),_0x195ee1=await get(_0xc8e077);_0x195ee1[_0x11f59f(0x10d)]()?(vendors=_0x195ee1[_0x11f59f(0x1b6)](),availableUsernames=Object[_0x11f59f(0x124)](vendors)):console[_0x11f59f(0x1bd)](_0x11f59f(0x13d));}catch(_0x55aa04){console['error']('Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:',_0x55aa04);}}const usernameInput=document[_0x2dd913(0x1a5)]('username'),passwordInput=document[_0x2dd913(0x1a5)](_0x2dd913(0x111)),suggestionsList=document[_0x2dd913(0x1a5)](_0x2dd913(0x130));usernameInput[_0x2dd913(0x155)](_0x2dd913(0x14a),()=>{const _0x3bd101=_0x2dd913,_0x444516=usernameInput['value']['toLowerCase'](),_0x2fd179=availableUsernames[_0x3bd101(0x1b7)](_0x2dfd07=>_0x2dfd07[_0x3bd101(0x19b)]()[_0x3bd101(0x114)](_0x444516));suggestionsList['innerHTML']='';if(_0x444516[_0x3bd101(0x1b3)]===0x0||_0x2fd179[_0x3bd101(0x1b3)]===0x0){suggestionsList[_0x3bd101(0x13c)][_0x3bd101(0x105)]='none';return;}_0x2fd179[_0x3bd101(0x18b)](_0x4735fe=>{const _0x3d28e1=_0x3bd101,_0x54e8f4=document[_0x3d28e1(0xfd)]('li');_0x54e8f4[_0x3d28e1(0x181)]=_0x4735fe,_0x54e8f4[_0x3d28e1(0x155)](_0x3d28e1(0x148),()=>{const _0xc75b59=_0x3d28e1;usernameInput[_0xc75b59(0x159)]=_0x4735fe,suggestionsList[_0xc75b59(0x18c)]='',suggestionsList[_0xc75b59(0x13c)][_0xc75b59(0x105)]=_0xc75b59(0x178);}),suggestionsList['appendChild'](_0x54e8f4);}),suggestionsList[_0x3bd101(0x13c)][_0x3bd101(0x105)]=_0x3bd101(0x19d);}),document[_0x2dd913(0x155)](_0x2dd913(0x148),_0x816067=>{const _0x3405a4=_0x2dd913;!usernameInput[_0x3405a4(0x172)](_0x816067[_0x3405a4(0x10c)])&&!suggestionsList[_0x3405a4(0x172)](_0x816067[_0x3405a4(0x10c)])&&(suggestionsList[_0x3405a4(0x13c)][_0x3405a4(0x105)]=_0x3405a4(0x178));});const rememberMeCheckbox=document['getElementById']('rememberMe'),storedUsername=localStorage['getItem'](_0x2dd913(0x169)),storedPassword=localStorage[_0x2dd913(0x1b0)](_0x2dd913(0x111)),storedTimestamp=localStorage['getItem']('usernameTimestamp'),now=Date[_0x2dd913(0x1b2)](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput['value']=storedUsername,passwordInput[_0x2dd913(0x159)]=storedPassword,rememberMeCheckbox[_0x2dd913(0x19a)]=!![]);const loginForm=document[_0x2dd913(0x1a5)](_0x2dd913(0x175)),loginError=document[_0x2dd913(0x1a5)](_0x2dd913(0x147)),ratesSection=document[_0x2dd913(0x135)](_0x2dd913(0x177)),historySection=document['getElementById']('historySection'),loginSection=document[_0x2dd913(0x1a5)](_0x2dd913(0x140)),messagesSection=document[_0x2dd913(0x1a5)](_0x2dd913(0x16e));loginForm['addEventListener'](_0x2dd913(0x100),async _0x1296be=>{const _0x1c0c44=_0x2dd913;_0x1296be[_0x1c0c44(0x18e)](),showLoader();const _0x5ea71c=usernameInput[_0x1c0c44(0x159)],_0x11fc93=passwordInput[_0x1c0c44(0x159)];vendors[_0x5ea71c]&&vendors[_0x5ea71c]['password']===_0x11fc93?(loginError[_0x1c0c44(0x13c)][_0x1c0c44(0x105)]=_0x1c0c44(0x178),ratesSection[_0x1c0c44(0x13c)]['display']=_0x1c0c44(0x19d),historySection['style'][_0x1c0c44(0x105)]=_0x1c0c44(0x178),loginSection[_0x1c0c44(0x13c)][_0x1c0c44(0x105)]=_0x1c0c44(0x178),messagesSection['style']['display']=_0x1c0c44(0x19d),currentVendorId=_0x5ea71c,rememberMeCheckbox[_0x1c0c44(0x19a)]?(localStorage[_0x1c0c44(0x145)](_0x1c0c44(0x169),_0x5ea71c),localStorage[_0x1c0c44(0x145)](_0x1c0c44(0x111),_0x11fc93),localStorage[_0x1c0c44(0x145)](_0x1c0c44(0x146),Date[_0x1c0c44(0x1b2)]())):(localStorage[_0x1c0c44(0x10a)](_0x1c0c44(0x169)),localStorage[_0x1c0c44(0x10a)](_0x1c0c44(0x111)),localStorage[_0x1c0c44(0x10a)](_0x1c0c44(0x146))),await syncTickets(),loadHistory(),listenForNewMessages(),lucide['createIcons'](),hideLoader()):(loginError[_0x1c0c44(0x13c)]['display']=_0x1c0c44(0x19d),loginError[_0x1c0c44(0x181)]=_0x1c0c44(0x188),hideLoader());});async function syncTickets(){const _0x38f19b=_0x2dd913;try{const _0x23f195=document[_0x38f19b(0x135)](_0x38f19b(0x112)),_0x272752=document[_0x38f19b(0x135)](_0x38f19b(0x149));_0x23f195[_0x38f19b(0x13c)][_0x38f19b(0x105)]=_0x38f19b(0x19d),_0x272752[_0x38f19b(0x13c)][_0x38f19b(0x105)]=_0x38f19b(0x178);const _0x500979=ref(db,'TicketsTotal'),_0x34fba4=await get(_0x500979);_0x34fba4[_0x38f19b(0x10d)]()?(localTickets=_0x34fba4[_0x38f19b(0x1b6)](),createTicketTable(),_0x23f195[_0x38f19b(0x13c)]['display']=_0x38f19b(0x178),_0x272752[_0x38f19b(0x13c)][_0x38f19b(0x105)]=_0x38f19b(0x198)):_0x23f195[_0x38f19b(0x181)]='Aucun\x20ticket\x20disponible.';}catch(_0x30c31d){console[_0x38f19b(0x12b)](_0x38f19b(0x14c),_0x30c31d),loadingMessage[_0x38f19b(0x181)]=_0x38f19b(0x1be);}}async function createTicketTable(){const _0x250346=_0x2dd913,_0x300b56=document['querySelector'](_0x250346(0x149));_0x300b56['innerHTML']=_0x250346(0x191);for(const [_0x17eefe,_0x419c75]of Object['entries'](localTickets)){const _0x5f4a5b=_0x419c75[_0x250346(0x125)]?_0x419c75[_0x250346(0x125)]['length']:0x0;if(_0x5f4a5b>0x0){const _0x337bc2=_0x419c75[_0x250346(0x15c)][0x0],_0x5cd93a=_0x300b56[_0x250346(0x197)]();_0x5cd93a[_0x250346(0x18c)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x17eefe+_0x250346(0x1ac)+_0x337bc2+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x5f4a5b+_0x250346(0x189)+_0x17eefe+_0x250346(0x141);}}document[_0x250346(0x135)]('.loading-message')[_0x250346(0x13c)][_0x250346(0x105)]=_0x250346(0x178),_0x300b56[_0x250346(0x13c)][_0x250346(0x105)]='table';}window['initTicketSale']=async function(_0x52cfa5){const _0x5425bb=_0x2dd913;showLoader();try{const _0x539b8b=ref(db,_0x5425bb(0x151)+_0x52cfa5),_0xb28dfd=await get(_0x539b8b);if(_0xb28dfd[_0x5425bb(0x10d)]()){const _0x4c0a9e=_0xb28dfd[_0x5425bb(0x1b6)]();if(!_0x4c0a9e[_0x5425bb(0x125)]||_0x4c0a9e[_0x5425bb(0x125)][_0x5425bb(0x1b3)]===0x0)throw new Error(_0x5425bb(0x17a));ticketToSell={'category':_0x52cfa5,'user':_0x4c0a9e['utilisateur'][0x0],'password':_0x4c0a9e[_0x5425bb(0x131)][0x0],'price':_0x4c0a9e['prix'][0x0],'updatedData':{..._0x4c0a9e,'utilisateur':_0x4c0a9e[_0x5425bb(0x125)][_0x5425bb(0xf9)](0x1),'motDePasse':_0x4c0a9e[_0x5425bb(0x131)][_0x5425bb(0xf9)](0x1),'prix':_0x4c0a9e[_0x5425bb(0x15c)][_0x5425bb(0xf9)](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x4b2cd3){console['error'](_0x5425bb(0x19c),_0x4b2cd3),showNotification(_0x5425bb(0x122),_0x5425bb(0x15a)),hideLoader();}};function showConfirmation(_0x20c935){const _0xff93df=_0x2dd913,_0x283557=document[_0xff93df(0x1a5)](_0xff93df(0x106)),_0x301298=document[_0xff93df(0x1a5)](_0xff93df(0x118)),_0xaca1e6=document['getElementById'](_0xff93df(0x1a8)),_0x24a4b9=document[_0xff93df(0x1a5)](_0xff93df(0x170));document['getElementById']('notification-title')[_0xff93df(0x181)]=_0xff93df(0x185),_0x301298['innerHTML']=_0xff93df(0xf7)+_0x20c935[_0xff93df(0x132)]+_0xff93df(0x15b)+_0x20c935[_0xff93df(0x17b)]+_0xff93df(0x10f),_0x24a4b9[_0xff93df(0x13c)]['display']='flex',_0xaca1e6[_0xff93df(0x13c)][_0xff93df(0x105)]=_0xff93df(0x178),_0x283557[_0xff93df(0x13c)][_0xff93df(0x105)]=_0xff93df(0x19d);}window[_0x2dd913(0x15f)]=async function(){const _0x5c9440=_0x2dd913;showLoader();if(!ticketToSell){showNotification(_0x5c9440(0x122),_0x5c9440(0x11a)),hideLoader();return;}try{const _0x56cd0e=ref(db,_0x5c9440(0x151)+ticketToSell[_0x5c9440(0x132)]);await set(_0x56cd0e,ticketToSell[_0x5c9440(0x158)]);const _0x1f71df=ref(db,_0x5c9440(0xfe));await push(_0x1f71df,{'category':ticketToSell['category'],'user':ticketToSell[_0x5c9440(0x1a4)],'password':ticketToSell['password'],'price':ticketToSell[_0x5c9440(0x17b)],'soldAt':Date['now'](),'vendorId':currentVendorId});const _0x4c55a4=ref(db,_0x5c9440(0x1b9)+currentVendorId);await push(_0x4c55a4,{'category':ticketToSell[_0x5c9440(0x132)],'user':ticketToSell[_0x5c9440(0x1a4)],'password':ticketToSell[_0x5c9440(0x111)],'price':ticketToSell['price'],'soldAt':Date[_0x5c9440(0x1b2)]()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x4787f3){console[_0x5c9440(0x12b)](_0x5c9440(0x1b5),_0x4787f3),showNotification(_0x5c9440(0x122),'Impossible\x20de\x20finaliser\x20la\x20vente'),hideLoader();}ticketToSell=null;};function showTicketDetails(_0x4c0d6e){const _0xfa3d7a=_0x2dd913,_0x1d21bd=document[_0xfa3d7a(0x1a5)](_0xfa3d7a(0x106)),_0x2364e1=document[_0xfa3d7a(0x1a5)](_0xfa3d7a(0x118)),_0x226a7e=document[_0xfa3d7a(0x1a5)]('ticket-actions'),_0x49adce=document[_0xfa3d7a(0x1a5)]('confirmation-buttons');document[_0xfa3d7a(0x1a5)](_0xfa3d7a(0x113))[_0xfa3d7a(0x181)]=_0xfa3d7a(0x1bb),_0x2364e1['innerHTML']=_0xfa3d7a(0x110)+_0x4c0d6e[_0xfa3d7a(0x132)]+_0xfa3d7a(0x199)+_0x4c0d6e['user']+_0xfa3d7a(0x11c)+_0x4c0d6e['password']+_0xfa3d7a(0x15b)+_0x4c0d6e['price']+_0xfa3d7a(0x10f),_0x49adce['style'][_0xfa3d7a(0x105)]=_0xfa3d7a(0x178),_0x226a7e[_0xfa3d7a(0x13c)][_0xfa3d7a(0x105)]=_0xfa3d7a(0x13f),_0x1d21bd['style']['display']='block',lucide[_0xfa3d7a(0x1a6)]();}function showSaleConfirmation(_0x2d6ee0){const _0x3a5a30=_0x2dd913,_0x41a74e=document[_0x3a5a30(0x1a5)](_0x3a5a30(0x106)),_0x5c5953=document[_0x3a5a30(0x1a5)](_0x3a5a30(0x118)),_0x47a0c7=document[_0x3a5a30(0x1a5)](_0x3a5a30(0x19e));_0x5c5953['innerHTML']=_0x3a5a30(0x110)+_0x2d6ee0[_0x3a5a30(0x132)]+_0x3a5a30(0x199)+_0x2d6ee0[_0x3a5a30(0x1a4)]+_0x3a5a30(0x11c)+_0x2d6ee0['password']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x2d6ee0['price']+_0x3a5a30(0x10f),_0x47a0c7[_0x3a5a30(0x18c)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x41a74e[_0x3a5a30(0x13c)][_0x3a5a30(0x105)]=_0x3a5a30(0x19d),lucide[_0x3a5a30(0x1a6)]();}window['confirmSale']=async function(){const _0x43f63a=_0x2dd913;showLoader();if(!currentReservedTicket){showNotification(_0x43f63a(0x122),'Aucun\x20ticket\x20en\x20cours\x20de\x20vente'),hideLoader();return;}try{const _0x2257ad=ref(db,_0x43f63a(0xfe));await push(_0x2257ad,{...currentReservedTicket,'soldAt':Date[_0x43f63a(0x1b2)](),'vendorId':currentVendorId});const _0x1983f1=ref(db,_0x43f63a(0x1b9)+currentVendorId);await push(_0x1983f1,{...currentReservedTicket,'soldAt':Date[_0x43f63a(0x1b2)]()}),showNotification('Succès',_0x43f63a(0x18d)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0x2b6197){console['error'](_0x43f63a(0x17e),_0x2b6197),showNotification(_0x43f63a(0x122),'Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente'),hideLoader();}},window[_0x2dd913(0x17d)]=function(){currentReservedTicket=null,hideNotification();};function showNotification(_0x9e093c,_0x3cae47){const _0x40729c=_0x2dd913,_0xe6cd74=document[_0x40729c(0x1a5)]('notification'),_0x1adba=document[_0x40729c(0x1a5)](_0x40729c(0x113)),_0x5ddb1b=document['getElementById'](_0x40729c(0x118)),_0x28ac27=document[_0x40729c(0x1a5)]('notification-buttons'),_0x17885a=document[_0x40729c(0x1a5)]('ticket-actions');_0x1adba[_0x40729c(0x181)]=_0x9e093c,_0x5ddb1b['innerHTML']=_0x3cae47,_0x9e093c===_0x40729c(0x12e)||_0x9e093c===_0x40729c(0x122)?(_0x28ac27['style']['display']=_0x40729c(0x178),_0x17885a[_0x40729c(0x13c)][_0x40729c(0x105)]=_0x40729c(0x178)):(_0x28ac27[_0x40729c(0x13c)][_0x40729c(0x105)]=_0x40729c(0x13f),_0x17885a[_0x40729c(0x13c)][_0x40729c(0x105)]=_0x40729c(0x178)),_0xe6cd74['style'][_0x40729c(0x105)]=_0x40729c(0x19d);}window[_0x2dd913(0x154)]=function(){const _0x238b9b=_0x2dd913;document[_0x238b9b(0x1a5)]('notification')['style'][_0x238b9b(0x105)]=_0x238b9b(0x178);};async function loadHistory(){const _0x3e0d27=_0x2dd913;showLoader();try{const _0x4a03da=ref(db,_0x3e0d27(0x1b9)+currentVendorId),_0x11540f=await get(_0x4a03da);let _0x2b2d51=[];_0x11540f[_0x3e0d27(0x10d)]()&&(_0x2b2d51=Object[_0x3e0d27(0x120)](_0x11540f[_0x3e0d27(0x1b6)]())[_0x3e0d27(0x16c)](([_0x311fa4,_0x205865])=>({'id':_0x311fa4,..._0x205865}))),filterHistory(_0x2b2d51),hideLoader();}catch(_0x3cfadd){console[_0x3e0d27(0x12b)](_0x3e0d27(0x180),_0x3cfadd),showNotification(_0x3e0d27(0x122),_0x3e0d27(0x108)),hideLoader();}}function filterHistory(_0x4abb6a){const _0x409ea8=_0x2dd913,_0x4deb00=document[_0x409ea8(0x1a5)](_0x409ea8(0x10e))['value'],_0x2997b4=new Date(),_0x537a33={'today':new Date(_0x2997b4[_0x409ea8(0x1ba)](0x0,0x0,0x0,0x0)),'week':new Date(_0x2997b4[_0x409ea8(0xf6)](_0x2997b4[_0x409ea8(0x13a)]()-_0x2997b4['getDay']())),'month':new Date(_0x2997b4[_0x409ea8(0xf6)](0x1)),'all':new Date(0x0)},_0x3e2848=_0x4abb6a['filter'](_0x15921=>new Date(_0x15921[_0x409ea8(0x12f)])>=_0x537a33[_0x4deb00]);updateStats(_0x3e2848),updateHistoryTable(_0x3e2848);}function updateStats(_0xfb2b05){const _0x427719=_0x2dd913,_0x26988e=_0xfb2b05['length'],_0x97892a=_0xfb2b05[_0x427719(0xfa)]((_0x265ab5,_0x57e271)=>_0x265ab5+parseFloat(_0x57e271['price']),0x0),_0x4b1cd7=_0xfb2b05['reduce']((_0x1147d7,_0x2985dc)=>{const _0x403c2a=_0x427719;return _0x1147d7[_0x2985dc[_0x403c2a(0x132)]]=(_0x1147d7[_0x2985dc[_0x403c2a(0x132)]]||0x0)+0x1,_0x1147d7;},{}),_0x10f5c2=Object[_0x427719(0x120)](_0x4b1cd7)[_0x427719(0x183)]((_0x3e878b,_0x165d88)=>_0x165d88[0x1]-_0x3e878b[0x1])[0x0]?.[0x0]||'-',_0xc80cc1=_0xfb2b05['length']>0x0?Math[_0x427719(0x133)](0x1,Math[_0x427719(0x13b)]((Date[_0x427719(0x1b2)]()-Math[_0x427719(0x126)](..._0xfb2b05[_0x427719(0x16c)](_0x504b02=>_0x504b02[_0x427719(0x12f)])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x3b890b=(_0x26988e/_0xc80cc1)[_0x427719(0x127)](0x1);document['getElementById']('totalTickets')[_0x427719(0x181)]=_0x26988e,document[_0x427719(0x1a5)]('totalRevenue')[_0x427719(0x181)]=_0x97892a['toLocaleString']()+_0x427719(0x1a7),document[_0x427719(0x1a5)]('topCategory')[_0x427719(0x181)]=_0x10f5c2,document['getElementById']('avgDaily')['textContent']=_0x3b890b;}function updateHistoryTable(_0x4b621f){const _0x59d1a0=_0x2dd913,_0x1dba1f=document[_0x59d1a0(0x1a5)](_0x59d1a0(0x152));_0x1dba1f['innerHTML']=_0x4b621f[_0x59d1a0(0x183)]((_0x30ad9d,_0x9c98ad)=>_0x9c98ad[_0x59d1a0(0x12f)]-_0x30ad9d[_0x59d1a0(0x12f)])[_0x59d1a0(0x16c)](_0x374fbe=>_0x59d1a0(0x168)+_0x374fbe['id']+_0x59d1a0(0x11e)+new Date(_0x374fbe[_0x59d1a0(0x12f)])[_0x59d1a0(0x121)]()+_0x59d1a0(0x1ac)+_0x374fbe[_0x59d1a0(0x132)]+_0x59d1a0(0x1ac)+_0x374fbe[_0x59d1a0(0x1a4)]+_0x59d1a0(0x1ac)+_0x374fbe[_0x59d1a0(0x17b)]+_0x59d1a0(0x157))[_0x59d1a0(0x134)]('');}window[_0x2dd913(0x144)]=async function(_0x33d89d){const _0x18a61c=_0x2dd913;showLoader();try{const _0x5ef8d9=ref(db,_0x18a61c(0x1b9)+currentVendorId+'/'+_0x33d89d),_0x34cc12=await get(_0x5ef8d9);if(_0x34cc12['exists']()){const _0x32689e=_0x34cc12[_0x18a61c(0x1b6)]();window[_0x18a61c(0x11f)](),showTicketDetails(_0x32689e),hideLoader();}else showNotification(_0x18a61c(0x122),_0x18a61c(0x10b)),hideLoader();}catch(_0x47dbda){console[_0x18a61c(0x12b)](_0x18a61c(0x138),_0x47dbda),showNotification(_0x18a61c(0x122),'Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket'),hideLoader();}},window[_0x2dd913(0x184)]=function(){const _0x349d83=_0x2dd913,_0x17f242=document[_0x349d83(0x1a5)](_0x349d83(0x17c)),_0x27194c=_0x17f242[_0x349d83(0x13c)][_0x349d83(0x105)]===_0x349d83(0x19d);_0x17f242[_0x349d83(0x13c)][_0x349d83(0x105)]=_0x27194c?'none':'block',!_0x27194c&&loadHistory();},window[_0x2dd913(0x11f)]=function(){const _0x54e726=_0x2dd913;document[_0x54e726(0x1a5)]('historySection')[_0x54e726(0x13c)][_0x54e726(0x105)]=_0x54e726(0x178);},window[_0x2dd913(0x1ab)]=function(){loadHistory();};function listenForNewMessages(){const _0x4061a7=_0x2dd913,_0xce53a=ref(db,_0x4061a7(0x190)+currentVendorId+_0x4061a7(0x16b));onChildAdded(_0xce53a,_0x2fc3d6=>{const _0x7daf29=_0x4061a7,_0x31c380=_0x2fc3d6[_0x7daf29(0x1b6)]();displayNewMessage(_0x31c380);});}function displayNewMessage(_0x79af){const _0x1873d8=_0x2dd913,_0x284795=document['getElementById']('messagesContainer'),_0x5ee8e4=document[_0x1873d8(0xfd)](_0x1873d8(0x16d));_0x5ee8e4['classList'][_0x1873d8(0x14f)](_0x1873d8(0x1bc)),_0x5ee8e4[_0x1873d8(0x18c)]=_0x1873d8(0x11b)+_0x79af[_0x1873d8(0x1af)]+_0x1873d8(0x1aa)+new Date(_0x79af['timestamp'])['toLocaleString']()+_0x1873d8(0x16f),_0x284795[_0x1873d8(0x14b)](_0x5ee8e4),_0x284795[_0x1873d8(0x196)]=_0x284795[_0x1873d8(0x129)];}window[_0x2dd913(0x123)]=function(){const _0x461d2d=_0x2dd913,_0x3f7096=document[_0x461d2d(0x1a5)](_0x461d2d(0x118))[_0x461d2d(0x1ae)];navigator['share']?navigator['share']({'title':_0x461d2d(0x107),'text':_0x3f7096})[_0x461d2d(0x19f)](()=>console[_0x461d2d(0x1bd)](_0x461d2d(0x1ad)))['catch'](_0x40ac8c=>console[_0x461d2d(0x12b)](_0x461d2d(0x128),_0x40ac8c)):alert(_0x461d2d(0x186));},window['copyTicket']=function(){const _0x3151cd=_0x2dd913,_0x368d64=document['getElementById'](_0x3151cd(0x118))['innerText'];navigator[_0x3151cd(0x1a0)][_0x3151cd(0x171)](_0x368d64)[_0x3151cd(0x19f)](()=>{const _0x584071=_0x3151cd;showNotification(_0x584071(0x12e),_0x584071(0xf5));})[_0x3151cd(0x187)](_0x287a67=>{const _0x5590e4=_0x3151cd;console[_0x5590e4(0x12b)](_0x5590e4(0x12d),_0x287a67),showNotification(_0x5590e4(0x122),_0x5590e4(0x164));});},window[_0x2dd913(0x194)]=async function(){const _0x206e26=_0x2dd913;showLoader();const _0x2979f8=document[_0x206e26(0x1a5)]('notification-message'),_0x49f944=new jsPDF(),_0x2dc4fa=await html2canvas(_0x2979f8),_0xd200f4=_0x2dc4fa[_0x206e26(0x179)](_0x206e26(0x101));_0x49f944['addImage'](_0xd200f4,_0x206e26(0x117),0xa,0xa,0xbe,0x0),_0x49f944[_0x206e26(0x119)](_0x206e26(0xf8)),hideLoader();};function showLoader(){const _0x9451b8=_0x2dd913;document['getElementById'](_0x9451b8(0x18a))[_0x9451b8(0x13c)]['display']=_0x9451b8(0x19d);}function hideLoader(){const _0x17fa83=_0x2dd913;document[_0x17fa83(0x1a5)](_0x17fa83(0x18a))[_0x17fa83(0x13c)]['display']='none';}function showPageLoader(){const _0x44025c=_0x2dd913;document[_0x44025c(0x1a5)](_0x44025c(0x18f))[_0x44025c(0x13c)][_0x44025c(0x105)]='flex';}function hidePageLoader(){const _0x1ddb2c=_0x2dd913;document[_0x1ddb2c(0x1a5)]('pageLoaderWrapper')[_0x1ddb2c(0x13c)]['display']='none';}async function processConnectedTickets(){const _0x2a721a=_0x2dd913,_0x22f2a9=document[_0x2a721a(0x1a5)](_0x2a721a(0x17f));try{_0x22f2a9['textContent']='Vérification\x20des\x20tickets\x20connectés...';const _0x2e7787=ref(db,_0x2a721a(0xfc)),_0x45b328=await get(_0x2e7787);let _0x152760=_0x45b328[_0x2a721a(0x1b6)]()||{};const _0x9220fd={};for(const _0x556763 in _0x152760){const _0x3d1872=_0x152760[_0x556763]['username'];!_0x9220fd[_0x3d1872]&&(_0x9220fd[_0x3d1872]=_0x152760[_0x556763]);}_0x22f2a9[_0x2a721a(0x181)]=_0x2a721a(0x16a);for(const _0x2476b1 in _0x9220fd){await processTicket(_0x9220fd[_0x2476b1]);}_0x22f2a9['textContent']=_0x2a721a(0x11d);for(const _0x18df76 in _0x9220fd){const _0x279e58=Object[_0x2a721a(0x124)](_0x152760)['find'](_0x3a2db2=>_0x152760[_0x3a2db2][_0x2a721a(0x169)]===_0x18df76);_0x279e58&&await remove(ref(db,_0x2a721a(0x1c0)+_0x279e58));}}catch(_0x3023a0){console[_0x2a721a(0x12b)](_0x2a721a(0x137),_0x3023a0),showNotification(_0x2a721a(0x122),_0x2a721a(0x102));}}async function processTicket(_0xeb7d49){const _0x439428=_0x2dd913,_0x23886d=document[_0x439428(0x1a5)]('pageLoaderMessage');try{_0x23886d[_0x439428(0x181)]=_0x439428(0x1a3)+_0xeb7d49['username']+'...';const _0x50d772=ref(db,_0x439428(0x14e)),_0x102091=await get(_0x50d772),_0x40ee42=_0x102091[_0x439428(0x1b6)]()||{};let _0x138acf=![];for(const _0x399905 in _0x40ee42){const _0x9c6ad=_0x40ee42[_0x399905];for(const _0x1e6337 in _0x9c6ad){if(_0x9c6ad[_0x1e6337]['user']===_0xeb7d49[_0x439428(0x169)]){_0x138acf=!![];break;}}if(_0x138acf)break;}if(!_0x138acf){_0x23886d['textContent']=_0x439428(0xfb)+_0xeb7d49[_0x439428(0x169)]+'...';const _0x5b1be3=ref(db,_0x439428(0x182)),_0xae3eab=ref(db,_0x439428(0x116)),_0x48e7c1=await get(_0x5b1be3),_0x2e31db=await get(_0xae3eab),_0xcb6da8=_0x48e7c1[_0x439428(0x1b6)]()||{},_0x2ad678=_0x2e31db[_0x439428(0x1b6)]()||{};let _0x2d0694=null,_0x205ba2=null,_0x54f0c7=null;for(const _0x441df0 in _0xcb6da8){const _0x5f2310=(_0xcb6da8[_0x441df0]['utilisateur']||[])['indexOf'](_0xeb7d49['username']);if(_0x5f2310>-0x1){_0x2d0694={'category':_0x441df0,'user':_0xcb6da8[_0x441df0][_0x439428(0x125)][_0x5f2310],'password':_0xcb6da8[_0x441df0][_0x439428(0x131)][_0x5f2310],'price':_0xcb6da8[_0x441df0][_0x439428(0x15c)][_0x5f2310],'updatedData':{..._0xcb6da8[_0x441df0],'utilisateur':_0xcb6da8[_0x441df0][_0x439428(0x125)]['filter']((_0x48405c,_0x2bc589)=>_0x2bc589!==_0x5f2310),'motDePasse':_0xcb6da8[_0x441df0]['motDePasse']['filter']((_0x36a828,_0x293b42)=>_0x293b42!==_0x5f2310),'prix':_0xcb6da8[_0x441df0][_0x439428(0x15c)]['filter']((_0x3b55a3,_0x24435f)=>_0x24435f!==_0x5f2310)}},_0x205ba2=ref(db,_0x439428(0x151)+_0x441df0),_0x54f0c7='TicketsTotal';break;}}if(!_0x2d0694)for(const _0x55c66a in _0x2ad678){if(_0x2ad678[_0x55c66a][_0x439428(0x1a4)]===_0xeb7d49[_0x439428(0x169)]){_0x2d0694={'category':_0x2ad678[_0x55c66a]['category'],'user':_0x2ad678[_0x55c66a][_0x439428(0x1a4)],'password':_0x2ad678[_0x55c66a][_0x439428(0x111)],'price':_0x2ad678[_0x55c66a][_0x439428(0x17b)]},_0x205ba2=ref(db,_0x439428(0x12a)+_0x55c66a),_0x54f0c7='TicketsTransit';break;}}_0x2d0694&&(_0x23886d[_0x439428(0x181)]='Vente\x20du\x20ticket\x20'+_0xeb7d49[_0x439428(0x169)]+'...',await sellTicketAutomatically(_0x2d0694,_0x205ba2,_0x54f0c7));}}catch(_0x36268c){console[_0x439428(0x12b)]('Erreur\x20lors\x20du\x20traitement\x20du\x20ticket\x20:',_0x36268c),showNotification(_0x439428(0x122),_0x439428(0x115)+_0xeb7d49[_0x439428(0x169)]+'.');}}async function sellTicketAutomatically(_0x2c4f1b,_0x110fda,_0x2b14bd){const _0x3d27ba=_0x2dd913;try{const _0x4a662a=_0x3d27ba(0x173),_0x837b42=ref(db,_0x3d27ba(0x1b9)+_0x4a662a);await push(_0x837b42,{'category':_0x2c4f1b[_0x3d27ba(0x132)],'user':_0x2c4f1b['user'],'password':_0x2c4f1b[_0x3d27ba(0x111)],'price':_0x2c4f1b[_0x3d27ba(0x17b)],'soldAt':Date[_0x3d27ba(0x1b2)]()});const _0x4d34bb=ref(db,_0x3d27ba(0xfe));await push(_0x4d34bb,{'category':_0x2c4f1b[_0x3d27ba(0x132)],'user':_0x2c4f1b['user'],'password':_0x2c4f1b[_0x3d27ba(0x111)],'price':_0x2c4f1b[_0x3d27ba(0x17b)],'soldAt':Date[_0x3d27ba(0x1b2)](),'vendorId':_0x4a662a}),_0x2b14bd===_0x3d27ba(0x182)?await set(_0x110fda,_0x2c4f1b[_0x3d27ba(0x158)]):await remove(_0x110fda),console[_0x3d27ba(0x1bd)]('Ticket\x20'+_0x2c4f1b['user']+_0x3d27ba(0x143));}catch(_0x439079){console['error'](_0x3d27ba(0x165),_0x439079),showNotification(_0x3d27ba(0x122),_0x3d27ba(0x12c));}}function _0x5631(_0x9e5c70,_0x583d3e){const _0x283916=_0x2839();return _0x5631=function(_0x563102,_0x3cd22f){_0x563102=_0x563102-0xf3;let _0x1aed65=_0x283916[_0x563102];return _0x1aed65;},_0x5631(_0x9e5c70,_0x583d3e);}function showSubscriptionRequiredModal(){const _0x359fc1=_0x2dd913;subscriptionRequiredModal[_0x359fc1(0x13c)][_0x359fc1(0x105)]='flex';}function hideSubscriptionRequiredModal(){const _0x232743=_0x2dd913;subscriptionRequiredModal[_0x232743(0x13c)]['display']=_0x232743(0x178);}function redirectToSubscription(){const _0x56c588=_0x2dd913;window[_0x56c588(0x14d)][_0x56c588(0x103)]='index.html';}async function checkSubscriptionStatus(){const _0x570e39=_0x2dd913,_0x2e537b=document['getElementById'](_0x570e39(0x17f));_0x2e537b[_0x570e39(0x181)]=_0x570e39(0x1b8);try{const _0x1c8c73=await get(adminRef),_0x2ad80b=_0x1c8c73[_0x570e39(0x1b6)](),_0x1a1879=new Date();if(_0x2ad80b&&_0x2ad80b['status']==='active'){const _0x3ec3ac=new Date(_0x2ad80b[_0x570e39(0x161)]);_0x3ec3ac<_0x1a1879?(_0x2e537b[_0x570e39(0x181)]=_0x570e39(0x193),showSubscriptionRequiredModal(),await adminRef[_0x570e39(0x136)]({'status':_0x570e39(0x166)})):_0x2e537b[_0x570e39(0x181)]='Abonnement\x20actif';}else _0x2e537b['textContent']=_0x570e39(0x104),showSubscriptionRequiredModal();}catch(_0x5d8ab0){console[_0x570e39(0x12b)](_0x570e39(0x176),_0x5d8ab0),_0x2e537b[_0x570e39(0x181)]=_0x570e39(0x162),showNotification(_0x570e39(0x122),_0x570e39(0x195));}}document[_0x2dd913(0x155)](_0x2dd913(0xf4),()=>{const _0x5e7879=_0x2dd913;showPageLoader(),processConnectedTickets()[_0x5e7879(0x19f)](()=>checkSubscriptionStatus())[_0x5e7879(0x19f)](()=>{fetchVendors(),lucide['createIcons'](),hidePageLoader();})[_0x5e7879(0x187)](_0x58b052=>{const _0x58f319=_0x5e7879;console['error'](_0x58f319(0x174),_0x58b052),hidePageLoader(),showNotification(_0x58f319(0x122),'Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.');});}),window['redirectToSubscription']=redirectToSubscription,window[_0x2dd913(0x109)]=redirectToSubscription;
    </script>
</body>
</html>