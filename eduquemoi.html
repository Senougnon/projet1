<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plateforme Gemini Améliorée</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.29.0/docxtemplater.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PizZip/3.0.6/pizzip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #50c878;
            --background-color: #f5f7fa;
            --text-color: #333333;
            --input-background: #ffffff;
            --button-color: #4a90e2;
            --hover-color: #3a7bc8;
            --sidebar-color: #2c3e50;
            --sidebar-text: #ecf0f1;
            --input-area-color: #e8f0fe;
        }

        [data-theme="dark"] {
            --primary-color: #6c5ce7;
            --secondary-color: #00b894;
            --background-color: #2d3436;
            --text-color: #ecf0f1;
            --input-background: #34495e;
            --button-color: #6c5ce7;
            --hover-color: #5b4cc4;
            --sidebar-color: #2c3e50;
            --sidebar-text: #ecf0f1;
            --input-area-color: #3d4852;
        }

        body, html {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            margin-right: 15px;
        }

        .logo {
            font-size: 1.5em;
            font-weight: bold;
        }

        .auth-buttons button, .theme-toggle {
            margin-left: 10px;
            background-color: var(--button-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .auth-buttons button:hover, .theme-toggle:hover {
            background-color: var(--hover-color);
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 260px;
            background-color: var(--sidebar-color);
            color: var(--sidebar-text);
            padding: 20px;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }

        .message-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .input-container {
            display: flex;
            padding: 15px;
            align-items: center;
            background-color: var(--input-area-color);
            border-radius: 10px;
            margin-top: 20px;
        }

        #userInput {
            flex-grow: 1;
            border: none;
            background-color: transparent;
            color: var(--text-color);
            font-size: 1em;
            padding: 10px;
            outline: none;
        }

        input, select, button, textarea {
            background-color: var(--input-background);
            border: 1px solid var(--button-color);
            color: var(--text-color);
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
        }

        button {
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--hover-color);
        }

        .message {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 10px;
            max-width: 80%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .user-message {
            background-color: var(--primary-color);
            color: white;
            align-self: flex-end;
        }

        .ai-message {
            background-color: var(--secondary-color);
            color: white;
            align-self: flex-start;
        }

        #modelSelect, #subscriptionSelect, #creditSelect {
            width: 100%;
            margin-bottom: 10px;
            background-color: var(--input-background);
            color: var(--text-color);
            border: 1px solid var(--button-color);
            padding: 10px;
            border-radius: 5px;
        }

        .hidden {
            display: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            opacity: 1;
        }

        .notification.success {
            background-color: var(--secondary-color);
        }

        .notification.error {
            background-color: #e74c3c;
        }

        .file-input {
            display: none;
        }

        .file-label {
            cursor: pointer;
            margin-left: 10px;
            color: var(--button-color);
        }

        .message-actions {
            margin-top: 5px;
        }

        .message-actions button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            margin-right: 5px;
            font-size: 0.9em;
        }

        .pinned-file {
            background-color: var(--input-background);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .pinned-file button {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-container">
            <button class="toggle-sidebar" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">Eduque moi</div>
        </div>
        <div class="auth-buttons">
            <button id="loginBtn" onclick="showLoginForm()">Se connecter</button>
            <button id="registerBtn" onclick="showRegisterForm()">S'inscrire</button>
            <button id="logoutBtn" onclick="logout()" class="hidden">Se déconnecter</button>
            <button class="theme-toggle" onclick="toggleTheme()">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <h3>Modèles</h3>
            <select id="modelSelect">
                <optgroup label="Modèle gratuit">
                    <option value="gemini-1.0-pro">Gemini 1.0 Pro</option>
                </optgroup>
                <optgroup label="Modèles avancés">
                    <option value="gemini-pro">Gemini Pro</option>
                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                    <option value="gemini-1.5-pro-latest">Gemini 1.5 Pro Latest</option>
                    <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                </optgroup>
            </select>

            <h3>Forfaits illimités</h3>
            <select id="subscriptionSelect">
                <option value="">Sélectionnez un forfait</option>
                <option value="24h">24 heures</option>
                <option value="3d">3 jours</option>
                <option value="7d">7 jours</option>
                <option value="30d">30 jours</option>
                <option value="3m">3 mois</option>
            </select>
            <button onclick="buySubscription()">Acheter le forfait</button>

            <h3>Acheter des crédits</h3>
            <select id="creditSelect">
                <option value="">Sélectionnez un pack</option>
                <option value="100">100 crédits</option>
                <option value="500">500 crédits</option>
                <option value="1000">1000 crédits</option>
            </select>
            <button onclick="buyCredits()">Acheter des crédits</button>

            <div id="userInfo" class="hidden">
                <h3>Informations utilisateur</h3>
                <p>Nom: <span id="username"></span></p>
                <p>Crédits: <span id="credits"></span></p>
                <p>Forfait: <span id="subscription"></span></p>
            </div>
        </div>

        <div class="chat-container">
            <div id="messageContainer" class="message-container"></div>
            <div id="pinnedFile" class="pinned-file hidden"></div>
            <div class="input-container">
                <textarea id="userInput" placeholder="Tapez votre message ici..."></textarea>
                <label for="fileInput" class="file-label">
                    <i class="fas fa-paperclip"></i>
                </label>
                <input type="file" id="fileInput" class="file-input" accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.txt" onchange="handleFileUpload(event)">
                <button onclick="sendMessage()">Envoyer</button>
            </div>
        </div>
    </div>

    <div id="loginForm" class="hidden">
        <input type="text" id="loginUsername" placeholder="Nom d'utilisateur">
        <input type="password" id="loginPassword" placeholder="Mot de passe">
        <button onclick="login()">Se connecter</button>
    </div>

    <div id="registerForm" class="hidden">
        <input type="text" id="registerUsername" placeholder="Nom d'utilisateur">
        <input type="password" id="registerPassword" placeholder="Mot de passe">
        <button onclick="register()">S'inscrire</button>
    </div>


    <script>
        const API_KEY = 'AIzaSyB3umTE3n2d5gwKzOmJz4ss1pFZMR8_vOE';
        const API_BASE_URL = 'https://generativelanguage.googleapis.com/v1beta/models/';
        let currentUser = null;
        let pinnedFile = null;

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB6AUBnK_7Vy2ABWI2JMo3ebG_Sljr8XlY",
            authDomain: "cyber-campus-2706f.firebaseapp.com",
            databaseURL: "https://cyber-campus-2706f-default-rtdb.firebaseio.com",
            projectId: "cyber-campus-2706f",
            storageBucket: "cyber-campus-2706f.appspot.com",
            messagingSenderId: "719410601264",
            appId: "1:719410601264:web:44fd2e3757721866303cf5",
            measurementId: "G-CEEFJP5LYZ"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function saveUserToLocalStorage(user) {
            localStorage.setItem('currentUser', JSON.stringify(user));
        }

        function getUserFromLocalStorage() {
            const userStr = localStorage.getItem('currentUser');
            return userStr ? JSON.parse(userStr) : null;
        }

        function removeUserFromLocalStorage() {
            localStorage.removeItem('currentUser');
        }

        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function updateUIForLoggedInUser() {
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('registerBtn').classList.add('hidden');
            document.getElementById('logoutBtn').classList.remove('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('username').textContent = currentUser.username;
            document.getElementById('credits').textContent = currentUser.credits;
            document.getElementById('subscription').textContent = currentUser.subscription || 'Aucun';
        }

        function updateUIForLoggedOutUser() {
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('registerBtn').classList.remove('hidden');
            document.getElementById('logoutBtn').classList.add('hidden');
            document.getElementById('userInfo').classList.add('hidden');
        }

        async function register() {
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            
            if (!username || !password) {
                showNotification('Veuillez remplir tous les champs.', 'error');
                return;
            }

            try {
                const userRef = db.ref('users/' + username);
                const snapshot = await userRef.once('value');
                if (snapshot.exists()) {
                    showNotification('Ce nom d\'utilisateur existe déjà.', 'error');
                    return;
                }
                
                await userRef.set({
                    password: password,
                    credits: 10,
                    subscription: null,
                    subscriptionEndDate: null
                });
                
                currentUser = { username, credits: 10, subscription: null, subscriptionEndDate: null };
                saveUserToLocalStorage(currentUser);
                updateUIForLoggedInUser();
                showNotification('Inscription réussie !', 'success');
            } catch (error) {
                console.error('Erreur lors de l\'inscription:', error);
                showNotification('Erreur lors de l\'inscription. Veuillez réessayer.', 'error');
            }
        }

        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showNotification('Veuillez remplir tous les champs.', 'error');
                return;
            }

            try {
                const userRef = db.ref('users/' + username);
                const snapshot = await userRef.once('value');
                if (snapshot.exists() && snapshot.val().password === password) {
                    currentUser = { 
                        username, 
                        credits: snapshot.val().credits,
                        subscription: snapshot.val().subscription,
                        subscriptionEndDate: snapshot.val().subscriptionEndDate
                    };
                    saveUserToLocalStorage(currentUser);
                    updateUIForLoggedInUser();
                    showNotification('Connexion réussie !', 'success');
                } else {
                    showNotification('Nom d\'utilisateur ou mot de passe incorrect.', 'error');
                }
            } catch (error) {
                console.error('Erreur lors de la connexion:', error);
                showNotification('Erreur lors de la connexion. Veuillez réessayer.', 'error');
            }
        }

        function logout() {
            currentUser = null;
            removeUserFromLocalStorage();
            updateUIForLoggedOutUser();
            showNotification('Déconnexion réussie.', 'success');
        }

        async function sendMessage() {
            if (!currentUser) {
                showNotification('Veuillez vous connecter pour envoyer des messages.', 'error');
                return;
            }

            const userInput = document.getElementById('userInput').value;
            const model = document.getElementById('modelSelect').value;

            if (!userInput && !pinnedFile) {
                showNotification('Veuillez entrer un message ou joindre un fichier.', 'error');
                return;
            }

            let fullMessage = userInput;
            if (pinnedFile) {
                fullMessage = `[Contenu du fichier joint: ${pinnedFile.content}]\n\n${userInput}`;
            }

            addMessageToChat('user', fullMessage);
            document.getElementById('userInput').value = '';

            if (model !== 'gemini-1.0-pro' && !hasValidSubscription() && currentUser.credits <= 0) {
                showNotification('Vous n\'avez plus de crédits. Veuillez acheter des crédits ou un forfait pour continuer.', 'error');
                return;
            }

            try {
                const response = await axios.post(`${API_BASE_URL}${model}:generateContent?key=${API_KEY}`, {
                    contents: [{ parts: [{ text: fullMessage }] }]
                });

                const aiResponse = response.data.candidates[0].content.parts[0].text;
                addMessageToChat('ai', aiResponse);

                if (model !== 'gemini-1.0-pro' && !hasValidSubscription()) {
                    currentUser.credits--;
                    updateUserCredits();
                }

                removePinnedFile();
            } catch (error) {
                console.error('Erreur:', error);
                showNotification('Erreur lors de la génération de la réponse.', 'error');
            }
        }

        function addMessageToChat(sender, message) {
            const messageContainer = document.getElementById('messageContainer');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender === 'user' ? 'user-message' : 'ai-message');
            messageElement.textContent = message;

            if (sender === 'ai') {
                const actionsElement = document.createElement('div');
                actionsElement.classList.add('message-actions');
                actionsElement.innerHTML = `
                    <button onclick="copyResponse(this)"><i class="fas fa-copy"></i></button>
                    <button onclick="exportResponse(this, 'word')"><i class="fas fa-file-word"></i></button>
                    <button onclick="exportResponse(this, 'pdf')"><i class="fas fa-file-pdf"></i></button>
                    <button onclick="shareResponse(this)"><i class="fas fa-share-alt"></i></button>
                `;
                messageElement.appendChild(actionsElement);
            }

            messageContainer.appendChild(messageElement);
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }

        function copyResponse(button) {
            const responseText = button.closest('.message').textContent;
            navigator.clipboard.writeText(responseText).then(() => {
                showNotification('Réponse copiée dans le presse-papiers', 'success');
            });
        }

        async function exportResponse(button, format) {
            const responseText = button.closest('.message').textContent;
            if (format === 'word') {
                const blob = await generateWordDoc(responseText);
                saveAs(blob, "response.docx");
            } else if (format === 'pdf') {
                const blob = await generatePDF(responseText);
                saveAs(blob, "response.pdf");
            }
            showNotification(`Export en ${format.toUpperCase()} réussi`, 'success');
        }

        async function generateWordDoc(text) {
            const content = `
                <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
                <w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
                    <w:body>
                        <w:p>
                            <w:r>
                                <w:t>${text}</w:t>
                            </w:r>
                        </w:p>
                    </w:body>
                </w:document>
            `;
            const zip = new PizZip();
            zip.file("word/document.xml", content);
            const blob = await zip.generateAsync({type: "blob", mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"});
            return blob;
        }

        function generatePDF(text) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(text, 10, 10);
            return doc.output('blob');
        }

        function shareResponse(button) {
            const responseText = button.closest('.message').textContent;
            if (navigator.share) {
                navigator.share({
                    title: 'Réponse de Eduque moi',
                    text: responseText
                }).then(() => {
                    showNotification('Partage réussi', 'success');
                }).catch((error) => {
                    console.error('Erreur lors du partage:', error);
                    showNotification('Erreur lors du partage', 'error');
                });
            } else {
                showNotification('Le partage n\'est pas pris en charge sur votre appareil', 'error');
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    pinnedFile = {
                        name: file.name,
                        content: e.target.result
                    };
                    const pinnedFileElement = document.getElementById('pinnedFile');
                    pinnedFileElement.innerHTML = `
                        <span>${file.name}</span>
                        <button onclick="removePinnedFile()"><i class="fas fa-times"></i></button>
                    `;
                    pinnedFileElement.classList.remove('hidden');
                };
                reader.readAsText(file);
            }
        }

        function removePinnedFile() {
            pinnedFile = null;
            const pinnedFileElement = document.getElementById('pinnedFile');
            pinnedFileElement.innerHTML = '';
            pinnedFileElement.classList.add('hidden');
        }

        function hasValidSubscription() {
            if (!currentUser.subscription || !currentUser.subscriptionEndDate) return false;
            return new Date() < new Date(currentUser.subscriptionEndDate);
        }

        async function updateUserCredits() {
            await db.ref('users/' + currentUser.username).update({
                credits: currentUser.credits
            });
            document.getElementById('credits').textContent = currentUser.credits;
        }

        function buySubscription() {
            const subscriptionType = document.getElementById('subscriptionSelect').value;
            if (!subscriptionType) {
                showNotification('Veuillez sélectionner un forfait.', 'error');
                return;
            }

            const subscriptionPrices = {
                '24h': 500, '3d': 1000, '7d': 2000, '30d': 5000, '3m': 12000
            };

            const price = subscriptionPrices[subscriptionType];

            var fedaPayInstance = FedaPay.init({
                public_key: 'pk_live_TfSz212W0xSMKK7oPEogkFmp',
                transaction: {
                    amount: price,
                    description: `Achat d'un forfait ${subscriptionType} pour Eduque moi`
                },
                customer: {
                    email: 'client@example.com'
                },
                onComplete: function(response) {
                    if (response.reason === FedaPay.CHECKOUT_COMPLETED) {
                        activateSubscription(subscriptionType);
                        showNotification(`Forfait ${subscriptionType} activé avec succès !`, 'success');
                    } else {
                        showNotification('Le paiement a été annulé ou a échoué.', 'error');
                    }
                }
            });
            fedaPayInstance.open();
        }

        async function activateSubscription(subscriptionType) {
            const durations = { '24h': 1, '3d': 3, '7d': 7, '30d': 30, '3m': 90 };
            const days = durations[subscriptionType];
            const endDate = new Date();
            endDate.setDate(endDate.getDate() + days);

            currentUser.subscription = subscriptionType;
            currentUser.subscriptionEndDate = endDate.toISOString();

            await db.ref('users/' + currentUser.username).update({
                subscription: subscriptionType,
                subscriptionEndDate: endDate.toISOString()
            });

            document.getElementById('subscription').textContent = subscriptionType;
            saveUserToLocalStorage(currentUser);
        }

        function buyCredits() {
            const creditAmount = document.getElementById('creditSelect').value;
            if (!creditAmount) {
                showNotification('Veuillez sélectionner un pack de crédits.', 'error');
                return;
            }

            const creditPrices = {
                '100': 1000, '500': 4500, '1000': 8000
            };

            const price = creditPrices[creditAmount];

            var fedaPayInstance = FedaPay.init({
                public_key: 'pk_live_TfSz212W0xSMKK7oPEogkFmp',
                transaction: {
                    amount: price,
                    description: `Achat de ${creditAmount} crédits pour Eduque moi`
                },
                customer: {
                    email: 'client@example.com'
                },
                onComplete: function(response) {
                    if (response.reason === FedaPay.CHECKOUT_COMPLETED) {
                        addCreditsToUser(parseInt(creditAmount));
                        showNotification(`${creditAmount} crédits ont été ajoutés à votre compte.`, 'success');
                    } else {
                        showNotification('Le paiement a été annulé ou a échoué.', 'error');
                    }
                }
            });
            fedaPayInstance.open();
        }

        async function addCreditsToUser(amount) {
            currentUser.credits += amount;
            await db.ref('users/' + currentUser.username).update({
                credits: currentUser.credits
            });
            document.getElementById('credits').textContent = currentUser.credits;
            saveUserToLocalStorage(currentUser);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 3000);
            }, 100);
        }

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const themeToggle = document.querySelector('.theme-toggle i');
            themeToggle.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('hidden');
        }

        // Fonction pour lire le contenu des fichiers
        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (event) => resolve(event.target.result);
                reader.onerror = (error) => reject(error);
                reader.readAsText(file);
            });
        }

        // Modification de la fonction handleFileUpload pour lire le contenu du fichier
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                try {
                    const content = await readFileContent(file);
                    pinnedFile = {
                        name: file.name,
                        content: content
                    };
                    const pinnedFileElement = document.getElementById('pinnedFile');
                    pinnedFileElement.innerHTML = `
                        <span>${file.name}</span>
                        <button onclick="removePinnedFile()"><i class="fas fa-times"></i></button>
                    `;
                    pinnedFileElement.classList.remove('hidden');
                } catch (error) {
                    console.error('Erreur lors de la lecture du fichier:', error);
                    showNotification('Erreur lors de la lecture du fichier.', 'error');
                }
            }
        }

        // Initialisation au chargement de la page
        window.onload = function() {
            const savedUser = getUserFromLocalStorage();
            if (savedUser) {
                currentUser = savedUser;
                updateUIForLoggedInUser();
            } else {
                updateUIForLoggedOutUser();
            }

            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);

            // Ajustement du champ de saisie pour qu'il prenne toute la largeur disponible
            const inputContainer = document.querySelector('.input-container');
            const userInput = document.getElementById('userInput');
            const fileLabel = document.querySelector('.file-label');
            const sendButton = inputContainer.querySelector('button');

            function adjustInputWidth() {
                const containerWidth = inputContainer.offsetWidth;
                const fileLabelWidth = fileLabel.offsetWidth;
                const sendButtonWidth = sendButton.offsetWidth;
                const padding = 20; // Ajustez selon vos besoins
                userInput.style.width = `${containerWidth - fileLabelWidth - sendButtonWidth - padding}px`;
            }

            // Appel initial et ajout d'un écouteur d'événement pour le redimensionnement de la fenêtre
            adjustInputWidth();
            window.addEventListener('resize', adjustInputWidth);
        };

        // Ajout d'un écouteur d'événement pour le chargement des ressources
        window.addEventListener('load', function() {
            document.body.classList.add('loaded');
        });
    </script>
</body>
</html>
