<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Convertisseur GSM B√©nin</title>
    <style>
        :root {
            --primary-color: #1a73e8;
            --primary-dark: #1557b0;
            --success-color: #34a853;
            --warning-color: #fbbc04;
            --error-color: #ea4335;
            --background-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --spacing-unit: 8px;
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            padding-bottom: calc(80px + var(--safe-area-bottom));
            overscroll-behavior-y: contain;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 2);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.25rem;
            color: var(--primary-color);
            text-align: center;
            margin: 0;
        }

        .info-banner {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: calc(var(--spacing-unit) * 2);
            margin: var(--spacing-unit);
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .info-banner p {
            margin: 4px 0;
            font-size: 0.95rem;
        }

        .info-banner p:last-child {
            color: var(--primary-dark);
            font-weight: 500;
        }

        .tabs {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            background-color: var(--surface-color);
            padding: 0 var(--spacing-unit);
            position: sticky;
            top: 56px;
            z-index: 99;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            flex: 1 0 auto;
            padding: calc(var(--spacing-unit) * 1.5);
            border: none;
            background: none;
            font-size: 0.95rem;
            color: var(--text-secondary);
            position: relative;
            min-width: 100px;
            transition: color 0.3s;
        }

        .tab.active {
            color: var(--primary-color);
            font-weight: 500;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 16px;
            right: 16px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 1.5px;
        }

        .content {
            padding: var(--spacing-unit);
            max-width: 600px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        .selection-controls {
            background-color: var(--surface-color);
            border-radius: 12px;
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding: calc(var(--spacing-unit) * 1.5);
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .select-all-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .select-all-checkbox {
            width: 22px;
            height: 22px;
            border-radius: 6px;
            border: 2px solid var(--primary-color);
            appearance: none;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-all-checkbox:checked {
            background-color: var(--primary-color);
        }

        .select-all-checkbox:checked::after {
            content: '‚úì';
            position: absolute;
            color: white;
            font-size: 14px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .select-all-label {
            font-size: 0.95rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .selection-info {
            margin-left: auto;
            font-size: 0.9rem;
            color: var(--text-secondary);
            background-color: var(--background-color);
            padding: 4px 12px;
            border-radius: 12px;
        }

        .contact-list {
            background-color: var(--surface-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .contact-item {
            padding: calc(var(--spacing-unit) * 2);
            border-bottom: 1px solid rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 2);
            background-color: var(--surface-color);
            transition: background-color 0.2s;
        }

        .contact-item:active {
            background-color: rgba(0,0,0,0.05);
        }

        .contact-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid var(--primary-color);
            appearance: none;
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .contact-checkbox:checked {
            background-color: var(--primary-color);
        }

        .contact-checkbox:checked::after {
            content: '‚úì';
            position: absolute;
            color: white;
            font-size: 16px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .contact-info {
            flex: 1;
            min-width: 0;
        }

        .contact-name {
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .contact-numbers {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .contact-number {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 2px 0;
        }

        .number-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            background-color: var(--background-color);
            padding: 2px 6px;
            border-radius: 8px;
        }

        .contact-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .status-warning {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .status-success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .progress-container {
            margin: calc(var(--spacing-unit) * 2) 0;
            background-color: rgba(0,0,0,0.08);
            border-radius: 6px;
            overflow: hidden;
            height: 6px;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0;
            transition: width 0.3s ease;
        }

        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 2);
            padding-bottom: calc(var(--spacing-unit) * 2 + var(--safe-area-bottom));
            box-shadow: 0 -1px 3px rgba(0,0,0,0.1);
            z-index: 100;
            display: flex;
            gap: var(--spacing-unit);
        }

        .btn {
            flex: 1;
            border: none;
            border-radius: 24px;
            padding: 16px;
            font-size: 1rem;
            font-weight: 500;
            color: white;
            background-color: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn:active:not(:disabled) {
            transform: scale(0.98);
        }

        .btn-primary {
            background-color: var(--primary-color);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .toast {
            position: fixed;
            bottom: calc(80px + var(--safe-area-bottom));
            left: 16px;
            right: 16px;
            background-color: rgba(0,0,0,0.9);
            color: white;
            padding: 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            text-align: center;
            animation: slideUp 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            z-index: 1000;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(26,115,232,0.2);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Manual Input Styles */
        .input-area {
            background-color: var(--surface-color);
            border-radius: 12px;
            padding: calc(var(--spacing-unit) * 2);
            margin-bottom: calc(var(--spacing-unit) * 2);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            font-size: 0.95rem;
            resize: vertical;
            margin-bottom: 12px;
        }

        .textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(26,115,232,0.2);
        }

        /* Import Area Styles */
        .import-area {
            background-color: var(--surface-color);
            border-radius: 12px;
            padding: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 2);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
        }

        .import-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .import-text {
            color: var(--text-secondary);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .file-input {
            display: none;
        }

        .import-button {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 12px 24px;
            border-radius: 24px;
            font-weight: 500;
            cursor: pointer;
        }

        /* Results Area */
        .results-area {
            background-color: var(--surface-color);
            border-radius: 12px;
            padding: calc(var(--spacing-unit) * 2);
            margin-top: calc(var(--spacing-unit) * 2);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .results-title {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-unit);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .stat-item {
            background-color: var(--background-color);
            padding: calc(var(--spacing-unit) * 2);
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>Conversion GSM B√©nin</h1>
    </header>

    <!-- Info Banner -->
    <div class="info-banner">
        <p><strong>Mise √† jour importante :</strong></p>
        <p>Ajout du pr√©fixe "01" aux num√©ros mobile du B√©nin</p>
        <p>Ex: +22960374877 ‚Üí +2290160374877</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="tabs">
        <button class="tab" onclick="switchTab('phone')">Contacts</button>
        <button class="tab" onclick="switchTab('manual')">Manuel</button>
        <button class="tab" onclick="switchTab('import')">Importer</button>
    </div>

    <!-- Main Content -->
    <div class="content">
        <!-- Phone Contacts Tab -->
        <div id="phone-tab" class="tab-content active">
            <div class="selection-controls">
                <div class="select-all-container">
                    <input type="checkbox" id="selectAll" class="select-all-checkbox" onchange="toggleSelectAll()">
                    <label for="selectAll" class="select-all-label">S√©lectionner tout</label>
                </div>
                <span class="selection-info" id="selectionCount">0 s√©lectionn√©</span>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="contact-list" id="contactsList"></div>
        </div>

        <!-- Manual Input Tab -->
        <div id="manual-tab" class="tab-content">
            <div class="input-area">
                <textarea class="textarea" id="manualInput" placeholder="Entrez vos num√©ros (un par ligne)
Exemple:
+22960374877
+22997123456
60374877"></textarea>
                <button class="btn btn-primary" onclick="convertManualNumbers()">Convertir</button>
            </div>
            <div class="results-area" id="manualResults" style="display: none;"></div>
        </div>

        <!-- Import Tab -->
        <div id="import-tab" class="tab-content">
            <div class="import-area">
                <div class="import-icon">üìÅ</div>
                <p class="import-text">Importez vos contacts depuis un fichier CSV ou VCF</p>
                <input type="file" id="fileInput" class="file-input" accept=".csv,.vcf" onchange="handleFileImport(this.files)">
                <button class="import-button" onclick="document.getElementById('fileInput').click()">
                    Choisir un fichier
                </button>
            </div>
            <div class="results-area" id="importResults" style="display: none;"></div>
        </div>
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
        <button id="updateButton" class="btn btn-primary" onclick="updateContacts()" disabled>
            Mettre √† jour les contacts
        </button>
    </div>

    <script>
        // Variables globales
        let contacts = [];
        let selectedContacts = new Set();

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('phone');
            initializeApp();
        });

        async function initializeApp() {
            if ('contacts' in navigator && 'ContactsManager' in window) {
                await requestContacts();
            } else {
                showToast("L'acc√®s aux contacts n'est pas support√© sur cet appareil");
            }
        }

        // Gestion des onglets
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
        }

        // Gestion des contacts
        async function requestContacts() {
            try {
                showLoading("Acc√®s aux contacts...");
                const props = ['tel', 'name'];
                const opts = { multiple: true };
                const rawContacts = await navigator.contacts.select(props, opts);
                contacts = processContacts(rawContacts);
                renderContacts();
                hideLoading();
            } catch (error) {
                hideLoading();
                showToast("Erreur lors de l'acc√®s aux contacts: " + error.message);
            }
        }

        function processContacts(rawContacts) {
            return rawContacts.map(contact => {
                const numbers = contact.tel.map(tel => {
                    let cleaned = tel.replace(/[\s\-\(\)]/g, '');
                    let needsUpdate = false;
                    let converted = cleaned;

                    if (cleaned.startsWith('+229') && !cleaned.includes('01')) {
                        converted = cleaned.slice(0, 4) + '01' + cleaned.slice(4);
                        needsUpdate = true;
                    } else if (cleaned.length === 8) {
                        converted = '+22901' + cleaned;
                        needsUpdate = true;
                    }

                    return {
                        original: cleaned,
                        converted: converted,
                        needsUpdate: needsUpdate
                    };
                });

                return {
                    name: contact.name?.[0] || 'Sans nom',
                    numbers: numbers,
                    needsUpdate: numbers.some(n => n.needsUpdate)
                };
            });
        }

        function renderContacts() {
            const list = document.getElementById('contactsList');
            list.innerHTML = '';

            contacts.forEach((contact, index) => {
                const div = document.createElement('div');
                div.className = 'contact-item';
                div.innerHTML = `
                    <input type="checkbox" class="contact-checkbox" 
                           data-index="${index}" 
                           ${selectedContacts.has(index) ? 'checked' : ''}
                           onchange="toggleContact(${index})">
                    <div class="contact-info">
                        <div class="contact-name">${contact.name}</div>
                        <div class="contact-numbers">
                            ${contact.numbers.map(num => `
                                <div class="contact-number">
                                    <span class="number-label">
                                        ${num.needsUpdate ? 'Nouveau' : 'Actuel'}
                                    </span>
                                    ${num.needsUpdate ? 
                                        `${num.original} ‚Üí ${num.converted}` : 
                                        num.original}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <span class="contact-status ${contact.needsUpdate ? 'status-warning' : 'status-success'}">
                        ${contact.needsUpdate ? '√Ä convertir' : '√Ä jour'}
                    </span>
                `;
                list.appendChild(div);
            });

            updateSelectionCount();
        }

        function toggleContact(index) {
            if (selectedContacts.has(index)) {
                selectedContacts.delete(index);
            } else {
                selectedContacts.add(index);
            }
            updateSelectionCount();
            updateButtonState();
        }

        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            if (selectAllCheckbox.checked) {
                contacts.forEach((_, index) => selectedContacts.add(index));
            } else {
                selectedContacts.clear();
            }
            renderContacts();
            updateSelectionCount();
            updateButtonState();
        }

        function updateSelectionCount() {
            const count = selectedContacts.size;
            document.getElementById('selectionCount').textContent = 
                `${count} contact${count > 1 ? 's' : ''} s√©lectionn√©${count > 1 ? 's' : ''}`;
        }

        function updateButtonState() {
            const updateButton = document.getElementById('updateButton');
            updateButton.disabled = selectedContacts.size === 0;
        }

        // Mise √† jour des contacts
        async function updateContacts() {
            try {
                showLoading("Mise √† jour des contacts...");
                const selectedContactsList = Array.from(selectedContacts);
                const total = selectedContactsList.length;
                let progress = 0;

                for (let index of selectedContactsList) {
                    const contact = contacts[index];
                    await updateContactInPhone(contact);
                    progress++;
                    updateProgress(progress / total * 100);
                }

                hideLoading();
                showToast("Contacts mis √† jour avec succ√®s");
                selectedContacts.clear();
                await requestContacts(); // Rafra√Æchir la liste
            } catch (error) {
                hideLoading();
                showToast("Erreur lors de la mise √† jour: " + error.message);
            }
        }

        async function updateContactInPhone(contact) {
            // Simulation de la mise √† jour
            // Dans une vraie impl√©mentation, utilisez l'API appropri√©e
            await new Promise(resolve => setTimeout(resolve, 200));
        }

        // Utilitaires
        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showLoading(message) {
            const loading = document.createElement('div');
            loading.className = 'loading-overlay';
            loading.innerHTML = `
                <div class="spinner"></div>
                <div class="loading-text">${message}</div>
            `;
            document.body.appendChild(loading);
        }

        function hideLoading() {
            const loading = document.querySelector('.loading-overlay');
            if (loading) loading.remove();
        }

        // Gestion des entr√©es manuelles
        function convertManualNumbers() {
            const input = document.getElementById('manualInput').value;
            const numbers = input.split('\n').filter(n => n.trim());
            const converted = numbers.map(processManualNumber);
            displayManualResults(converted);
        }

        function processManualNumber(number) {
            const cleaned = number.trim().replace(/[\s\-\(\)]/g, '');
            if (cleaned.startsWith('+229') && !cleaned.includes('01')) {
                return {
                    original: cleaned,
                    converted: cleaned.slice(0, 4) + '01' + cleaned.slice(4),
                    valid: true
                };
            } else if (cleaned.length === 8) {
                return {
                    original: cleaned,
                    converted: '+22901' + cleaned,
                    valid: true
                };
            }
            return {
                original: cleaned,
                converted: cleaned,
                valid: false
            };
        }

        function displayManualResults(results) {
            const resultsArea = document.getElementById('manualResults');
            resultsArea.style.display = 'block';
            resultsArea.innerHTML = `
                <h3 class="results-title">R√©sultats</h3>
                <div class="results-stats">
                    <div class="stat-item">
                        <div class="stat-value">${results.filter(r => r.valid).length}</div>
                        <div class="stat-label">Convertis</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${results.filter(r => !r.valid).length}</div>
                        <div class="stat-label">Invalides</div>
                    </div>
                </div>
                <textarea class="textarea" readonly>
${results.map(r => r.valid ? r.converted : r.original + ' (Format invalide)').join('\n')}
                </textarea>
            `;
        }

        // Gestion de l'import de fichiers
        function handleFileImport(files) {
            const file = files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                if (file.name.toLowerCase().endsWith('.csv')) {
                    processCSV(content);
                } else if (file.name.toLowerCase().endsWith('.vcf')) {
                    processVCard(content);
                }
            };
            reader.readAsText(file);
        }

        function processCSV(content) {
            const lines = content.split('\n');
            const numbers = [];
            lines.forEach(line => {
                const columns = line.split(',');
                columns.forEach(col => {
                    const cleaned = col.trim().replace(/["']/g, '');
                    if (cleaned.match(/^\+?(?:229)?\d{8,}$/)) {
                        numbers.push(cleaned);
                    }
                });
            });
            const converted = numbers.map(processManualNumber);
            displayImportResults(converted);
        }

        function processVCard(content) {
            const numbers = [];
            const vcardRegex = /TEL[^:]*:([\+\d\s\-\(\)]+)/g;
            let match;
            while ((match = vcardRegex.exec(content)) !== null) {
                const number = match[1].replace(/[\s\-\(\)]/g, '');
                if (number.match(/^\+?(?:229)?\d{8,}$/)) {
                    numbers.push(number);
                }
            }
            const converted = numbers.map(processManualNumber);
            displayImportResults(converted);
        }

        function displayImportResults(results) {
            const resultsArea = document.getElementById('importResults');
            resultsArea.style.display = 'block';
            resultsArea.innerHTML = `
                <h3 class="results-title">R√©sultats de l'import</h3>
                <div class="results-stats">
                    <div class="stat-item">
                        <div class="stat-value">${results.filter(r => r.valid).length}</div>
                        <div class="stat-label">Num√©ros valides</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${results.filter(r => !r.valid).length}</div>
                        <div class="stat-label">Formats invalides</div>
                    </div>
                </div>
                <textarea class="textarea" readonly>
${results.map(r => `${r.valid ? r.converted : r.original + ' (Format invalide)'}`).join('\n')}
                </textarea>
                <div class="export-buttons">
                    <button class="btn btn-primary" onclick="exportToVCard(results)">
                        Exporter en VCard
                    </button>
                    <button class="btn btn-success" onclick="exportToCSV(results)">
                        Exporter en CSV
                    </button>
                </div>
            `;
        }

        // Fonctions d'export
        function exportToVCard(results) {
            let vcard = '';
            results.filter(r => r.valid).forEach((result, index) => {
                vcard += 'BEGIN:VCARD\n';
                vcard += 'VERSION:3.0\n';
                vcard += `FN:Contact ${index + 1}\n`;
                vcard += `TEL:${result.converted}\n`;
                vcard += 'END:VCARD\n';
            });
            downloadFile(vcard, 'contacts_convertis.vcf', 'text/vcard');
        }

        function exportToCSV(results) {
            const csv = 'Num√©ro Original,Num√©ro Converti\n' + 
                results.filter(r => r.valid)
                    .map(r => `${r.original},${r.converted}`)
                    .join('\n');
            downloadFile(csv, 'contacts_convertis.csv', 'text/csv');
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Gestionnaire d'√©v√©nements pour le retour haptique
        document.addEventListener('touchstart', function(e) {
            if (e.target.matches('button, .contact-checkbox, .select-all-checkbox')) {
                if ('vibrate' in navigator) {
                    navigator.vibrate(10);
                }
            }
        }, { passive: true });

        // Gestionnaire de mise en cache pour le mode hors ligne
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(function(err) {
                console.error('Service Worker registration failed:', err);
            });
        }
    </script>

    <!-- Service Worker pour le mode hors ligne -->
    <script>
        // Service Worker minimal
        const CACHE_NAME = 'benin-converter-v1';
        const urlsToCache = [
            '/',
            '/index.html',
            '/styles.css',
            '/script.js'
        ];

        self.addEventListener('install', function(event) {
            event.waitUntil(
                caches.open(CACHE_NAME)
                    .then(function(cache) {
                        return cache.addAll(urlsToCache);
                    })
            );
        });

        self.addEventListener('fetch', function(event) {
            event.respondWith(
                caches.match(event.request)
                    .then(function(response) {
                        return response || fetch(event.request);
                    })
            );
        });
    </script>
</body>
</html>
