
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion Cyber Campus</title>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

body {
    background: linear-gradient(135deg, #970158, #00026e, #000000);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    color: #fff;
    overflow-x: hidden;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

header {
    background-color: rgba(0, 0, 0, 0.5);
    padding: 20px 0;
    position: relative;
    overflow: hidden;
}

.header-image {
    width: 100%;
    height: 300px;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
}

.img1 {
    animation: slide1 10s linear infinite;
}

.img2 {
    animation: slide2 10s linear infinite;
}

.logo {
    font-size: 2.5em;
    color: white;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    position: relative;
    z-index: 2;
}

.logo::before {
    content: '';
    font-size: 0.8em;
    margin-right: 10px;
    animation: rotate 5s linear infinite;
    display: inline-block;
}

@keyframes rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.moon {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 2em;
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

nav {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
}

.nav-button {
    background-color: rgba(255, 255, 255, 0.2);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.nav-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.5s, height 0.5s;
}

.nav-button:hover::before {
    width: 300px;
    height: 300px;
}

@keyframes buttonPulse {
    0% { background-color: #fdbb2d; color: #1a2a6c; }
    50% { background-color: #1a2a6c; color: #fdbb2d; }
    100% { background-color: #fdbb2d; color: #1a2a6c; }
}

.nav-button.animate-pay {
    animation: buttonPulse 3s ease-in-out infinite;
}

@keyframes textChange {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

.nav-button.animate-pay {
    animation: textChange 0.5s ease-in-out, buttonPulse 3s ease-in-out infinite;
}

main {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin-top: 40px;
    position: relative;
}

.login-section, .rates-section, .locations-section, .products-section {
    background-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s, box-shadow 0.3s;
}

.login-section:hover, .rates-section:hover, .locations-section:hover, .products-section:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
}

.login-section {
    flex-basis: 100%;
}

.rates-section, .locations-section, .products-section {
    flex-basis: calc(33.333% - 20px);
}

h2 {
    color: white;
    margin-bottom: 15px;
    position: relative;
    display: inline-block;
}

h2::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0;
    height: 2px;
    background-color: #fdbb2d;
    transition: width 0.3s;
}

.login-section:hover h2::after,
.rates-section:hover h2::after,
.locations-section:hover h2::after,
.products-section:hover h2::after {
    width: 100%;
}

form {
    display: flex;
    flex-direction: column;
}

input {
    margin-bottom: 10px;
    padding: 10px;
    border: none;
    border-radius: 25px;
    background-color: rgb(253, 242, 221);
    color: white;
    transition: background-color 0.3s;
}

input:focus {
    background-color: rgba(255, 255, 255, 0.3);
    outline: none;
}

button {
    background-color: #fdbb2d;
    color: #1a2a6c;
    border: none;
    padding: 10px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
}

button:hover {
    background-color: #1a2a6c;
    color: #fdbb2d;
}

table {
    width: 100%;
    border-collapse: collapse;
    color: white;
}

th, td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

ul {
    list-style-type: none;
}

li {
    margin-bottom: 5px;
    position: relative;
    padding-left: 20px;
}

li::before {
    content: '➤';
    position: absolute;
    left: 0;
    color: #fdbb2d;
}

.animated-text-container {
    overflow: hidden;
    height: 50px;
}

.animated-text {
    animation: scrollText 10s linear infinite;
}

@keyframes scrollText {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-50px); }
}

footer {
    margin-top: auto;
    text-align: center;
    padding: 20px;
    background-color: rgba(0, 0, 0, 0.5);
}

@keyframes slide1 {
    0% { transform: translateX(0); }
    50% { transform: translateX(-100%); }
    100% { transform: translateX(0); }
}

@keyframes slide2 {
    0% { transform: translateX(100%); }
    50% { transform: translateX(0); }
    100% { transform: translateX(100%); }
}

@media (max-width: 768px) {
    .rates-section, .locations-section, .products-section {
        flex-basis: 100%;
    }
}

.notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.9);
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    display: none;
    color: #1a2a6c;
    text-align: center;
}

.notification h2 {
    color: #1a2a6c;
    margin-bottom: 20px;
}

.notification p {
    margin-bottom: 15px;
}

.close-icon {
    position: absolute;
    top: 10px;
    right: 10px;
    cursor: pointer;
    font-size: 20px;
}

#ticket-select {
    margin-bottom: 20px;
}

#nomTicket {
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

#paymentFrame {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0);
    z-index: 1000;
}

#paymentFrame > div {
    position: relative;
    width: 100%;
    height: 100%;
    margin: 0% auto;
    background-color: rgba(253, 255, 223, 0);
    border-radius: 3px;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
}

#paymentIframe {
    width: 100%;
    height: 100%;
    border: none;
}

#closePaymentFrame {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1001;
    background: none;
    border: none;
    font-size: 50px;
    cursor: pointer;
    color: #ffffff;
}

#paymentIframe {
    width: 100%;
    height: 100%;
    border: none;
}

.delete-button {
    background-color: #f44336;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
    margin: 10px;
}

.delete-button:hover {
    background-color: #d32f2f;
}

.notification.error {
    background-color: #fdd;
    border: 1px solid #faa;
    color: #f00;
}

.notification .ticket-info {
    margin-bottom: 15px;
    text-align: left;
}

.notification .ticket-info p {
    margin-bottom: 5px;
}

.notification .login-button,
.notification .delete-button {
    display: inline-block;
    margin: 0 10px;
}

.notification .login-button {
    background-color: #fdbb2d;
    color: #1a2a6c;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
}

.notification .login-button:hover {
    background-color: #1a2a6c;
    color: #fdbb2d;
}
    </style>

    $(if chap-id)
    <form name="sendin" action="$(link-login-only)" method="post" style="display:none">
        <input type="hidden" name="username" />
        <input type="hidden" name="password" />
        <input type="hidden" name="dst" value="$(link-orig)" />
        <input type="hidden" name="popup" value="true" />
    </form>

    <script src="/md5.js"></script>
    <script>
        function doLogin() {
            document.sendin.username.value = document.login.username.value;
            document.sendin.password.value = hexMD5('$(chap-id)' + document.login.password.value + '$(chap-challenge)');
            document.sendin.submit();
            return false;
        }
    </script>
    $(endif)
    <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, get, set, push, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB6AUBnK_7Vy2ABWI2JMo3ebG_Sljr8XlY",
            authDomain: "cyber-campus-2706f.firebaseapp.com",
            databaseURL: "https://cyber-campus-2706f-default-rtdb.firebaseio.com",
            projectId: "cyber-campus-2706f",
            storageBucket: "cyber-campus-2706f.appspot.com",
            messagingSenderId: "719410601264",
            appId: "1:719410601264:web:44fd2e3757721866303cf5",
            measurementId: "G-CEEFJP5LYZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let localTickets = {}; 

        async function syncTickets() {
            try {
                const ticketsTotalRef = ref(db, 'TicketsTotal');
                const snapshot = await get(ticketsTotalRef);
                localTickets = snapshot.val() || {};

                const ticketsVendusRef = ref(db, 'TicketsVendus');
                const snapshotVendus = await get(ticketsVendusRef);
                const ticketsVendus = snapshotVendus.val() || {};

                for (const ticketId in ticketsVendus) {
                    const ticketVendu = ticketsVendus[ticketId];
                    const ticketName = Object.keys(localTickets).find(
                        (key) => localTickets[key].utilisateur.includes(ticketVendu.user) 
                    );

                    if (ticketName) {
                        const ticketIndex = localTickets[ticketName].utilisateur.indexOf(ticketVendu.user);

                        if (ticketIndex > -1) {
                            localTickets[ticketName].utilisateur.splice(ticketIndex, 1);
                            localTickets[ticketName].motDePasse.splice(ticketIndex, 1);
                            localTickets[ticketName].prix.splice(ticketIndex, 1);

                            if (localTickets[ticketName].utilisateur.length === 0) {
                                delete localTickets[ticketName];
                            }
                        }
                    }
                }

                console.log("Données synchronisées:", localTickets);
                createTicketTable();
            } catch (error) {
                console.error("Erreur lors de la synchronisation des tickets:", error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            syncTickets();
            setInterval(syncTickets, 5000);
        });

        function storeTicketLocally(ticketData) {
            localStorage.setItem('storedTicket', JSON.stringify(ticketData));
        }

        function updateButtonText() {
            const payButton = document.querySelector('.nav-button.animate-pay');
            const storedTicket = localStorage.getItem('storedTicket');

            if (storedTicket) {
                payButton.textContent = 'Voir mon ticket';
            } else {
                payButton.textContent = 'Payer un ticket';
            }
        }

        function showTariffsTable() {
            const tariffsTable = document.querySelector('.rates-section table');
            const loadingMessage = document.querySelector('.rates-section .loading-message');
            tariffsTable.style.display = 'table';
            loadingMessage.style.display = 'none';
        }

        async function createTicketTable() {
            const table = document.querySelector('.rates-section table');
            table.innerHTML = `
                <tr>
                    <th>Catégorie</th>
                    <th>Prix (FCFA)</th>
                    <th>Action</th>
                </tr>
            `;

            for (const [category, data] of Object.entries(localTickets)) {
                const price = data.prix[0];
                const lienPaiement = data.lienPaiement;
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${category}</td>
                    <td>${price}</td>
                    <td><button onclick="initPayment('${category}', ${price}, '${lienPaiement}')">Payer</button></td>
                `;
            }

            showTariffsTable();
        }

        window.initPayment = function(category, amount, lienPaiement) {
            var fedaPayInstance = FedaPay.init({
                public_key: 'pk_live_TfSz212W0xSMKK7oPEogkFmp',
                transaction: {
                    amount: amount,
                    description: `Achat de ticket ${category}`
                },
                customer: {
                    email: 'client@example.com'
                },
                onComplete: function(response) {
                    if (response.reason === FedaPay.DIALOG_DISMISSED) {
                        showNotification("Paiement annulé", "Le paiement a été annulé.");
                    } else if (response.reason === FedaPay.CHECKOUT_COMPLETED) {
                        showNotification("Paiement réussi", "Récupération du ticket...");
                        getTicket(category);
                    }
                }
            });
            fedaPayInstance.open();
        };

        async function getTicket(category) {
            const ticketsRef = ref(db, `TicketsTotal/${category}`);
            const snapshot = await get(ticketsRef);
            if (snapshot.exists()) {
                const data = snapshot.val();
                const motDePasse = data.motDePasse[0];
                const utilisateur = data.utilisateur[0];
                const prix = data.prix[0];
                const ticket = {motDePasse, utilisateur, prix};
                
                displayTicket(ticket, category);
                
                await storeTicketVendu(ticket);
                
                await updateDatabase(category, data);
            } else {
                showNotification("Erreur", "Plus de tickets disponibles pour cette catégorie.");
            }
        }

        async function storeTicketVendu(ticket) {
            const ticketsVendusRef = ref(db, 'TicketsVendus');
            await push(ticketsVendusRef, {
                password: ticket.motDePasse,
                price: ticket.prix,
                user: ticket.utilisateur
            });
            console.log("Ticket vendu stocké avec succès");
        }

        async function updateDatabase(category, data) {
            const updatedData = {
                lienPaiement: data.lienPaiement,
                motDePasse: data.motDePasse.slice(1),
                prix: data.prix.slice(1),
                utilisateur: data.utilisateur.slice(1)
            };

            await set(ref(db, `TicketsTotal/${category}`), updatedData);

            console.log("Database updated successfully");
            await syncTickets();
        }

        function displayTicket(ticket, category) {
            storeTicketLocally({
                ticketName: category,
                user: ticket.utilisateur,
                password: ticket.motDePasse,
                price: ticket.prix
            });
            showNotification("Ticket acheté",
                `Nom d'utilisateur: ${ticket.utilisateur}\n` +
                `Mot de passe: ${ticket.motDePasse}\n` +
                `Prix: ${ticket.prix} F`,
                true
            );
            updateButtonText();
        }

        function showNotification(title, message, isTicketPurchase = false) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationMessage = document.getElementById('notification-message');

            notificationTitle.textContent = title;
            notificationMessage.textContent = message;

            if (isTicketPurchase) {
                const loginButton = document.createElement('button');
                loginButton.className = 'login-button';
                loginButton.textContent = 'Connexion';
                loginButton.addEventListener('click', () => {
                    const lines = message.split('\n');
                    const username = lines[0].split(': ')[1];
                    const password = lines[1].split(': ')[1];
                    autoLogin(username, password);
                });
                notification.appendChild(loginButton);

                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-button';
                deleteButton.textContent = 'Supprimer';
                deleteButton.addEventListener('click', deleteTicket);
                notification.appendChild(deleteButton);
            }

            notification.style.display = 'block';
        }

        window.hideNotification = function() {
            document.getElementById('notification').style.display = 'none';
        }

        function autoLogin(username, password) {
            document.login.username.value = username;
            document.login.password.value = password;
            document.login.submit();
        }

        function deleteTicket() {
            localStorage.removeItem('storedTicket');
            showNotification("Ticket supprimé", "Votre ticket a été supprimé avec succès.");
            updateButtonText();
        }

        window.addEventListener('load', () => {
            updateButtonText();
            const payButton = document.querySelector('.nav-button.animate-pay');
            payButton.addEventListener('click', () => {
                const storedTicket = localStorage.getItem('storedTicket');
                if (storedTicket) {
                    const ticket = JSON.parse(storedTicket);
                    showNotification('Votre ticket', 
                        `Nom d'utilisateur: ${ticket.user}\n` +
                        `Mot de passe: ${ticket.password}\n` +
                        `Prix: ${ticket.price} F`
                    );
                } else {
                    document.querySelector('.rates-section').scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

    </script>
</head>
<body>
    <header>
        <div class="container">
            <h1 class="logo">Cyber Campus</h1>
            <div class="moon"></div>
            <img class="header-image img1" src="img/img1.jpg" alt="Image de fond">
            <img class="header-image img2" src="img/img2.jpg" alt="Image de fond">
            <nav>
                <button class="nav-button">+229 60374877</button>
                <button class="nav-button animate-pay">Payer un ticket</button>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="login-section">
            <h2>Connexion</h2>
            <form name="login" action="$(link-login-only)" method="post" $(if chap-id) onSubmit="return doLogin()" $(endif)>
                <input type="hidden" name="dst" value="$(link-orig)" />
                <input type="hidden" name="popup" value="true" />
                <input type="text" name="username" placeholder="Nom d'utilisateur" value="$(username)" required>
                <input type="password" name="password" placeholder="Mot de passe" required>
                <button type="submit">Se connecter</button>
            </form>
            <p class="info $(if error)alert$(endif)">
                $(if error == "")Veuillez vous connecter pour utiliser le service hotspot Internet $(if trial == 'yes')<br />Essai gratuit disponible, <a href="$(link-login-only)?dst=$(link-orig-esc)&username=T-$(mac-esc)">cliquez ici</a>.$(endif)
                $(endif)
                $(if error)$(error)$(endif)
            </p>
        </section>

        <section class="rates-section">
            <h2>Tarifs</h2>
            <div>
                MTN Bénin est retiré temporairement des methodes de paiement pour des raisons d'instabilité connexion.
            </div>
            <div class="loading-message">Chargement des tarifs...</div>
            <table style="display: none;"></table>
        </section>

        <section class="products-section">
            <div class="loading-message">              
                <h2>Discuter avec l'IA</h2>
                <iframe src="https://eduquemoi.netlify.app/" width="100%" height="500px" frameborder="0"></iframe>
            </div>
        </section>

        <section class="locations-section">
            <h2>Nos sites de connexion</h2>
            <ul>
                <li>Cyber Campus Arafat</li>
                <li>Cyber Campus Université</li>
                <li>Cyber Campus Rose croix</li>
                <li>Cyber Campus Banikanni 1</li>
                <li>Cyber Campus Banikanni 2</li>
                <li>Cyber Campus Marché Tchakitibam</li>
            </ul>
        </section>

        <section class="products-section">
            <h2>Nos produits</h2>
            <ul>
                <li>Maintenance réseau</li>
                <li>Installation Wi-Fi Zone</li>
                <li>Maintenance informatique</li>
                <li>Creation de Site web et Application mobile</li>
            </ul>
        </section>

    </main>

    <footer>
        <div class="anitext">
            PROPULSE PAR EVISIONS
        </div>
    </footer>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">×</span>
        <h2 id="notification-title"></h2>
        <p id="notification-message"></p>
    </div>

    <div id="paymentFrame">
        <div>
            <button id="closePaymentFrame" onclick="closePaymentFrame()">×</button>
            <iframe id="paymentIframe"></iframe>
        </div>
    </div>

</body>
</html>
